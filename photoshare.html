---
layout: default
title: "PhotoShare - Share Photos Privately"
description: "PhotoShare - Share photos privately with a unique code. Upload photos and share the code with friends to view."
---

  <style>
  :root {
    /* Dark Theme Colors */
    --dark-bg: #121212;
    --dark-header-bg: #181818;
    --dark-header-border: #2a2a2a;
    --dark-text: #fff;
    --dark-icon-color: #ccc;
    --dark-icon-hover: #fff;
    --dark-icon-hover-bg: rgba(255,255,255,0.1);
    --dark-system-msg: #aaa;

    /* Light Theme Colors */
    --light-bg: #f5f5f5;
    --light-header-bg: #ffffff;
    --light-header-border: #e0e0e0;
    --light-text: #333;
    --light-icon-color: #666;
    --light-icon-hover: #333;
    --light-icon-hover-bg: rgba(0,0,0,0.05);
    --light-system-msg: #777;

    /* Common Colors */
    --primary-btn: #6e8efb;
    --primary-btn-hover: #5b7cf9;
    --secondary-btn: #25D366;
    --secondary-btn-hover: #128C7E;
    --danger-btn: #ff4d4d;
    --danger-btn-hover: #ff3333;
  }

  * {
    box-sizing: border-box;
  }

  html, body {
    overflow-x: hidden;
    height: 100%;
    margin: 0;
    padding: 0;
  }
    
  body {
    font-family: 'Segoe UI', sans-serif;
    background: var(--dark-bg);
    color: var(--dark-text);
    display: flex;
    flex-direction: column;
    min-height: 100vh;
    transition: background 0.3s, color 0.3s;
  }

  body.light-mode {
    background: var(--light-bg);
    color: var(--light-text);
  }

  .app-header {
    position: fixed !important;
    top: 0;
    left: 0;
    width: 100%;
    height: 50px;
    background: var(--dark-header-bg);
    padding: 8px 15px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 15px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.4);
    border-bottom: 1px solid var(--dark-header-border);
    z-index: 1000;
  }

  .light-mode .app-header {
    background: var(--light-header-bg);
    border-bottom: 1px solid var(--light-header-border);
  }

  .header-left {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .header-right {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .logo {
    height: 40px;
    width: 40px;
    border-radius: 10px;
  }

  .app-title {
    font-size: 1.1em;
    color: var(--dark-text);
    margin: 0;
  }

  .light-mode .app-title {
    color: var(--light-text);
  }

  .btn-primary {
    background: var(--primary-btn);
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 30px;
    cursor: pointer;
    font-size: 1em;
    font-weight: bold;
    transition: all 0.3s;
  }

  .btn-primary:hover {
    background: var(--primary-btn-hover);
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  }

  .btn-secondary {
    background: var(--secondary-btn);
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 30px;
    cursor: pointer;
    font-size: 1em;
    font-weight: bold;
    transition: all 0.3s;
  }

  .btn-secondary:hover {
    background: var(--secondary-btn-hover);
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  }

  .btn-danger {
    background: var(--danger-btn);
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 30px;
    cursor: pointer;
    font-size: 1em;
    font-weight: bold;
    transition: all 0.3s;
  }

  .btn-danger:hover {
    background: var(--danger-btn-hover);
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  }

  .theme-toggle {
    background: none;
    border: none;
    color: var(--dark-icon-color);
    font-size: 1.1em;
    cursor: pointer;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: all 0.3s;
  }

  .theme-toggle:hover {
    background: var(--dark-icon-hover-bg);
  }

  .light-mode .theme-toggle {
    color: var(--light-icon-color);
  }

  .light-mode .theme-toggle:hover {
    background: var(--light-icon-hover-bg);
  }

  .container {
    max-width: 1000px;
    padding: 60px 0 10px 10px;
    flex: 1;
    width: 100%;
  }

  .tab-container {
    display: flex;
    margin-bottom: 30px;
    border-bottom: 1px solid var(--dark-header-border);
    justify-content: center;
  }

  .light-mode .tab-container {
    border-bottom: 1px solid var(--light-header-border);
  }

  .tab {
    padding: 12px 25px;
    cursor: pointer;
    font-weight: 600;
    border-bottom: 3px solid transparent;
    transition: all 0.3s;
    font-size: 1.05em;
    color: var(--dark-icon-color);
    position: relative;
  }

  .light-mode .tab {
    color: var(--light-icon-color);
  }

  .tab.active {
    border-bottom: 3px solid var(--primary-btn);
    color: var(--primary-btn);
  }

  .light-mode .tab.active {
    color: var(--primary-btn);
  }

  .tab-content {
    display: none;
    animation: fadeIn 0.4s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .tab-content.active {
    display: block;
  }

  .upload-area {
    border: 2px dashed var(--dark-header-border);
    border-radius: 15px;
    padding: 40px 30px;
    text-align: center;
    margin-bottom: 25px;
    cursor: pointer;
    transition: all 0.3s;
    background: var(--dark-header-bg);
  }

  .light-mode .upload-area {
    border-color: var(--light-header-border);
    background: var(--light-header-bg);
  }

  .upload-area:hover {
    border-color: var(--primary-btn);
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
  }

  .upload-area i {
    font-size: 48px;
    margin-bottom: 15px;
    color: var(--primary-btn);
  }

  .upload-area h3 {
    margin: 0 0 8px;
    font-size: 1.3em;
  }

  .upload-area p {
    margin: 0;
    color: var(--dark-icon-color);
    font-size: 0.95em;
  }

  .light-mode .upload-area p {
    color: var(--light-icon-color);
  }

  .preview-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    gap: 15px;
    margin-bottom: 25px;
  }

  .preview-item {
    position: relative;
    width: 100%;
    height: 160px;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    transition: transform 0.3s;
  }

  .preview-item:hover {
    transform: translateY(-5px);
  }

  .preview-item img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    cursor: pointer;
  }

  .preview-item-remove {
    position: absolute;
    top: 8px;
    right: 8px;
    background: rgba(255,0,0,0.8);
    color: white;
    width: 28px;
    height: 28px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s;
  }

  .preview-item-remove:hover {
    background: rgba(255,0,0,1);
    transform: scale(1.1);
  }

  .code-display {
    font-size: 2.2em;
    font-weight: bold;
    letter-spacing: 5px;
    text-align: center;
    margin: 25px 0;
    padding: 20px;
    background: rgba(0,0,0,0.2);
    border-radius: 12px;
    box-shadow: inset 0 0 10px rgba(0,0,0,0.2);
    font-family: 'Courier New', monospace;
  }

  .light-mode .code-display {
    background: rgba(0,0,0,0.05);
  }

  .share-buttons {
    display: flex;
    gap: 15px;
    justify-content: center;
    margin-bottom: 20px;
    flex-wrap: wrap;
  }

  .viewer-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
  }

  .viewer-input {
    display: flex;
    gap: 12px;
    margin-bottom: 25px;
    width: 100%;
    max-width: 500px;
  }

  .viewer-input input {
    flex: 1;
    padding: 14px 18px;
    border-radius: 30px;
    border: none;
    font-size: 1.05em;
    background: var(--dark-header-bg);
    color: var(--dark-text);
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    transition: all 0.3s;
  }

  .viewer-input input:focus {
    outline: none;
    box-shadow: 0 0 0 2px var(--primary-btn);
  }

  .light-mode .viewer-input input {
    background: var(--light-header-bg);
    color: var(--light-text);
  }

  .viewer-gallery {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 20px;
    width: 100%;
    padding: 10px;
  }

  .viewer-gallery img {
    width: 100%;
    height: 220px;
    object-fit: cover;
    border-radius: 12px;
    transition: transform 0.3s, box-shadow 0.3s;
    box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    cursor: pointer;
  }

  .viewer-gallery img:hover {
    transform: scale(1.05);
    box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    z-index: 1;
  }

  /* Fullscreen viewer */
  .fullscreen-viewer {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.9);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2000;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s;
  }

  .fullscreen-viewer.active {
    opacity: 1;
    pointer-events: all;
  }

  .fullscreen-viewer img {
    max-width: 90%;
    max-height: 90%;
    object-fit: contain;
    border-radius: 8px;
  }

  .fullscreen-viewer .close-btn {
    position: absolute;
    top: 20px;
    right: 20px;
    background: rgba(255,255,255,0.2);
    color: white;
    border: none;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    font-size: 1.5em;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s;
  }

  .fullscreen-viewer .close-btn:hover {
    background: rgba(255,255,255,0.3);
    transform: rotate(90deg);
  }

  .fullscreen-viewer .nav-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(255,255,255,0.2);
    color: white;
    border: none;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    font-size: 1.5em;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s;
  }

  .fullscreen-viewer .nav-btn:hover {
    background: rgba(255,255,255,0.3);
  }

  .fullscreen-viewer .prev-btn {
    left: 20px;
  }

  .fullscreen-viewer .next-btn {
    right: 20px;
  }

  .system-msg {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0,0,0,0.85);
    color: white;
    padding: 18px 28px;
    border-radius: 10px;
    text-align: center;
    z-index: 100;
    display: none;
    font-size: 1.05em;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    animation: fadeIn 0.3s ease;
  }

  .light-mode .system-msg {
    background: rgba(255,255,255,0.95);
    color: #333;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
  }

  @media (max-width: 768px) {
    .tab {
      padding: 10px 20px;
      font-size: 1em;
    }
    
    .preview-container {
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    }

    .preview-item {
      height: 140px;
    }

    .viewer-gallery {
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    }

    .viewer-gallery img {
      height: 160px;
    }
    
    .code-display {
      font-size: 1.8em;
      padding: 15px;
    }
    
    .share-buttons {
      flex-direction: column;
      align-items: center;
    }
    
    .share-buttons button {
      width: 100%;
    }
    
    .viewer-input {
      flex-direction: column;
    }

    .fullscreen-viewer .nav-btn {
      width: 40px;
      height: 40px;
      font-size: 1.2em;
    }
  }

  @media (max-width: 480px) {
    .preview-container {
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    }

    .preview-item {
      height: 120px;
    }

    .viewer-gallery {
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    }

    .viewer-gallery img {
      height: 140px;
    }
  }
  </style>

  <header class="app-header">
    <div class="header-left">
      <img src="photo-gallery.png" alt="PhotoShare Logo" class="logo">
      <h1 class="app-title">PhotoShare</h1>
    </div>
    <div class="header-right">
      <button class="theme-toggle" id="themeToggle" title="Toggle Dark/Light Mode">
        <i class="fas fa-moon"></i>
      </button>
    </div>
  </header>

  <div class="container">
    <div class="tab-container">
      <div class="tab active" data-tab="upload">Upload Photos</div>
      <div class="tab" data-tab="view">View Photos</div>
    </div>

    <!-- Upload Tab -->
    <div class="tab-content active" id="upload-tab">
      <div class="upload-area" id="uploadArea">
        <i class="fas fa-cloud-upload-alt"></i>
        <h3>Click to Upload Photos</h3>
        <p>or drag and drop files here</p>
        <input type="file" id="fileInput" accept="image/*" multiple style="display: none;">
      </div>

      <div class="preview-container" id="previewContainer"></div>

      <button class="btn-primary" id="generateBtn" style="display: none; width: 100%;">Generate Share Code</button>

      <div class="code-display" id="codeDisplay" style="display: none;"></div>

      <div class="share-buttons" id="shareButtons" style="display: none;">
        <button class="btn-secondary" id="copyBtn"><i class="fas fa-copy"></i> Copy Code</button>
        <button class="btn-secondary" id="copyUrlBtn" onclick="copyUrl()"><i class="fas fa-link"></i> Copy URL</button>
        <button class="btn-secondary" id="whatsappBtn"><i class="fab fa-whatsapp"></i> Share via WhatsApp</button>
      </div>
    </div>

    <!-- View Tab -->
    <div class="tab-content" id="view-tab">
      <div class="viewer-container">
        <div class="viewer-input">
          <input type="text" id="codeInput" placeholder="Enter 5-digit code" maxlength="5">
          <button class="btn-primary" id="viewBtn">View</button>
        </div>

        <div class="viewer-gallery" id="viewerGallery"></div>
      </div>
    </div>
  </div>

  <!-- Fullscreen Viewer -->
  <div class="fullscreen-viewer" id="fullscreenViewer">
    <button class="close-btn" id="closeFullscreen"><i class="fas fa-times"></i></button>
    <button class="nav-btn prev-btn" id="prevBtn"><i class="fas fa-chevron-left"></i></button>
    <img id="fullscreenImage" src="" alt="Fullscreen view">
    <button class="nav-btn next-btn" id="nextBtn"><i class="fas fa-chevron-right"></i></button>
  </div>

  <div class="system-msg" id="systemMsg"></div>

<div style="width:95%; max-width:700px; margin:20px auto; text-align:center; border:1px solid; border-radius:20px; padding:20px;">
  <div style="display:flex; justify-content:space-between; gap:20px; flex-wrap:wrap;">
    
    <a href="chat/index.html" 
       style="flex:1; min-width:130px; padding:12px 0; background:#fff; color:#000; border:1px solid #000; border-radius:20px; font-size:16px; font-weight:bold; text-decoration:none; text-align:center; transition:0.3s;">
       <i class="fas fa-message" style="margin-right:8px;"></i> Stranger Chat
    </a>
    
    <a href="chat/group.html" 
       style="flex:1; min-width:130px; padding:12px 0; background:#000; color:#fff; border:1px solid #fff; border-radius:20px; font-size:16px; font-weight:bold; text-decoration:none; text-align:center; transition:0.3s;">
       <i class="fa-solid fa-user-group" style="margin-right:8px;"></i> Group Chat
    </a>
    
  </div>
</div>

  <!-- Display Ads -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-7059052735946479"
       data-ad-slot="8592327962"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({});
  </script>

<main class="info-section" style="padding: 20px; max-width: 800px; margin: 0 auto;">
  <h2>Private Photo Sharing – Auto Delete in 24 Hours</h2>
  
  <p>Upload your photo securely and receive a unique <strong>5-digit code</strong>. Share this code with your friends or send it via WhatsApp. Only the person who enters the code can view your photo. For your privacy, the photo will be <strong>automatically deleted after 24 hours</strong>.</p>
  
  <h2>How It Works</h2>
  <ol>
    <li><strong>Upload</strong> – Choose a photo from your device. No sign-up or registration required.</li>
    <li><strong>Get a Code</strong> – A unique 5-digit code is generated instantly (e.g., 48291).</li>
    <li><strong>Share</strong> – Copy the code or send it directly via WhatsApp or any other messenger.</li>
    <li><strong>View</strong> – Only people with the code can see your photo.</li>
    <li><strong>Auto-Delete</strong> – Your photo will be permanently removed from our servers after 24 hours.</li>
  </ol>

     <!-- Display Ads -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-7059052735946479"
       data-ad-slot="8592327962"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
    
  <h2>Why Choose This Service?</h2>
  <ul>
    <li>No account or personal information required</li>
    <li>Fast and easy photo sharing</li>
    <li>Secure and private – you control who sees your photo</li>
    <li>Automatic deletion after 24 hours for extra privacy</li>
    <li>Works on any device – phone, tablet, or computer</li>
  </ul>
  
  <p style="font-size:0.9em; color:#555;">
    <strong>Note:</strong> Share your code only with people you trust. We never store your photos beyond 24 hours.
  </p>
</main>

    <!-- Display Ads -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-7059052735946479"
       data-ad-slot="8592327962"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({});
  </script>

{% include scripts.html %}

  <script>
  // Firebase configuration
  const firebaseConfig = {
    databaseURL: "https://talkrush-76259-default-rtdb.asia-southeast1.firebasedatabase.app/"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // DOM elements
  const uploadArea = document.getElementById('uploadArea');
  const fileInput = document.getElementById('fileInput');
  const previewContainer = document.getElementById('previewContainer');
  const generateBtn = document.getElementById('generateBtn');
  const codeDisplay = document.getElementById('codeDisplay');
  const shareButtons = document.getElementById('shareButtons');
  const copyBtn = document.getElementById('copyBtn');
  const whatsappBtn = document.getElementById('whatsappBtn');
  const codeInput = document.getElementById('codeInput');
  const viewBtn = document.getElementById('viewBtn');
  const viewerGallery = document.getElementById('viewerGallery');
  const systemMsg = document.getElementById('systemMsg');
  const tabs = document.querySelectorAll('.tab');
  const tabContents = document.querySelectorAll('.tab-content');
  const fullscreenViewer = document.getElementById('fullscreenViewer');
  const fullscreenImage = document.getElementById('fullscreenImage');
  const closeFullscreen = document.getElementById('closeFullscreen');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');

  // Variables
  let uploadedFiles = [];
  let shareCode = '';
  let currentViewerImages = [];
  let currentFullscreenIndex = 0;

  // Event listeners
  uploadArea.addEventListener('click', () => fileInput.click());
  fileInput.addEventListener('change', handleFileSelect);
  generateBtn.addEventListener('click', generateShareCode);
  copyBtn.addEventListener('click', copyCode);
  whatsappBtn.addEventListener('click', shareViaWhatsApp);
  viewBtn.addEventListener('click', viewPhotos);
  closeFullscreen.addEventListener('click', closeFullscreenViewer);
  prevBtn.addEventListener('click', showPrevImage);
  nextBtn.addEventListener('click', showNextImage);

  // Tab switching
  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      tabs.forEach(t => t.classList.remove('active'));
      tabContents.forEach(c => c.classList.remove('active'));
      
      tab.classList.add('active');
      document.getElementById(`${tab.dataset.tab}-tab`).classList.add('active');
    });
  });

  // Drag and drop functionality
  uploadArea.addEventListener('dragover', (e) => {
    e.preventDefault();
    uploadArea.style.borderColor = 'var(--primary-btn)';
    uploadArea.style.transform = 'translateY(-3px)';
  });

  uploadArea.addEventListener('dragleave', () => {
    uploadArea.style.borderColor = '';
    uploadArea.style.transform = '';
  });

  uploadArea.addEventListener('drop', (e) => {
    e.preventDefault();
    uploadArea.style.borderColor = '';
    uploadArea.style.transform = '';
    if (e.dataTransfer.files.length) {
      fileInput.files = e.dataTransfer.files;
      handleFileSelect({ target: fileInput });
    }
  });

  // Image resizing function
  function resizeImage(file, maxWidth, maxHeight, quality) {
    return new Promise((resolve) => {
      const reader = new FileReader();
      reader.onload = (event) => {
        const img = new Image();
        img.onload = () => {
          const canvas = document.createElement('canvas');
          let width = img.width;
          let height = img.height;

          // Calculate new dimensions while maintaining aspect ratio
          if (width > height) {
            if (width > maxWidth) {
              height *= maxWidth / width;
              width = maxWidth;
            }
          } else {
            if (height > maxHeight) {
              width *= maxHeight / height;
              height = maxHeight;
            }
          }

          canvas.width = width;
          canvas.height = height;
          const ctx = canvas.getContext('2d');
          ctx.drawImage(img, 0, 0, width, height);
          
          // Convert to data URL with specified quality
          resolve(canvas.toDataURL('image/jpeg', quality));
        };
        img.src = event.target.result;
      };
      reader.readAsDataURL(file);
    });
  }

  // Handle file selection with size validation
  function handleFileSelect(event) {
    const files = event.target.files;
    if (files.length === 0) return;

    uploadedFiles = [];
    previewContainer.innerHTML = '';
    
    for (let i = 0; i < Math.min(files.length, 20); i++) {
      const file = files[i];
      
      // Skip non-image files
      if (!file.type.startsWith('image/')) {
        showSystemMessage(`Skipped ${file.name} - not an image file`);
        continue;
      }
      
      // Check file size (10MB max)
      if (file.size > 10 * 1024 * 1024) {
        showSystemMessage(`Skipped ${file.name} - file too large (max 10MB)`);
        continue;
      }
      
      uploadedFiles.push(file);
      
      const reader = new FileReader();
      reader.onload = (e) => {
        const previewItem = document.createElement('div');
        previewItem.className = 'preview-item';
        
        previewItem.innerHTML = `
          <img src="${e.target.result}" alt="Preview" data-index="${uploadedFiles.length - 1}">
          <div class="preview-item-remove" data-index="${uploadedFiles.length - 1}">
            <i class="fas fa-times"></i>
          </div>
        `;
        
        previewContainer.appendChild(previewItem);
        
        // Add click event for fullscreen
        previewItem.querySelector('img').addEventListener('click', (e) => {
          openFullscreenViewer(uploadedFiles.map(f => URL.createObjectURL(f)), 
                             parseInt(e.target.dataset.index));
        });
        
        // Add remove event
        previewItem.querySelector('.preview-item-remove').addEventListener('click', (e) => {
          e.stopPropagation();
          const index = parseInt(e.target.closest('.preview-item-remove').dataset.index);
          uploadedFiles.splice(index, 1);
          previewContainer.removeChild(previewItem);
          if (uploadedFiles.length === 0) {
            generateBtn.style.display = 'none';
          }
        });
      };
      reader.readAsDataURL(file);
    }

    if (uploadedFiles.length > 0) {
      generateBtn.style.display = 'block';
    } else {
      generateBtn.style.display = 'none';
    }
  }

  // Generate share code with image resizing
  async function generateShareCode() {
    if (uploadedFiles.length === 0) {
      showSystemMessage('Please upload at least one photo');
      return;
    }

    // Generate a 5-digit code
    shareCode = Math.floor(10000 + Math.random() * 90000).toString();
    codeDisplay.textContent = shareCode;
    codeDisplay.style.display = 'block';
    shareButtons.style.display = 'flex';
    generateBtn.style.display = 'none';

    showSystemMessage('Uploading photos...');

    try {
      // Upload photos to Firebase with resizing
      for (let i = 0; i < uploadedFiles.length; i++) {
        const file = uploadedFiles[i];
        
        // Check file size (resize if larger than 2MB)
        if (file.size > 2 * 1024 * 1024) {
          // Resize to max 2000px with 80% quality
          const resizedDataUrl = await resizeImage(file, 2000, 2000, 0.8);
          await db.ref(`photos/${shareCode}/${i}`).set(resizedDataUrl);
        } else {
          // Upload original if small enough
          const dataUrl = await new Promise((resolve) => {
            const reader = new FileReader();
            reader.onload = (e) => resolve(e.target.result);
            reader.readAsDataURL(file);
          });
          await db.ref(`photos/${shareCode}/${i}`).set(dataUrl);
        }
      }

      showSystemMessage('Photos uploaded successfully!');
      // Set expiration (24 hours)
      await db.ref(`photos/${shareCode}/expires`).set(Date.now() + 24 * 60 * 60 * 1000);
    } catch (error) {
      console.error('Upload error:', error);
      showSystemMessage('Error uploading photos. Please try again.');
    }
  }

  // Copy code to clipboard
  function copyCode() {
    navigator.clipboard.writeText(shareCode)
      .then(() => showSystemMessage('Code copied to clipboard!'))
      .catch(() => showSystemMessage('Failed to copy code'));
  }

  // Copy URL to clipboard
  function copyUrl() {
    const url = `${window.location.href.split('?')[0]}?code=${shareCode}`;
    navigator.clipboard.writeText(url)
      .then(() => showSystemMessage('URL copied to clipboard!'))
      .catch(() => showSystemMessage('Failed to copy URL'));
  }

  // Share via WhatsApp
  function shareViaWhatsApp() {
    const url = `${window.location.href.split('?')[0]}?code=${shareCode}`;
    const text = `Check out my photos! Use this code on PhotoShare: ${shareCode} or click: ${url}`;
    window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
  }

  // View photos
  function viewPhotos() {
    const code = codeInput.value.trim();
    if (code.length !== 5 || !/^\d+$/.test(code)) {
      showSystemMessage('Please enter a valid 5-digit code');
      return;
    }

    viewerGallery.innerHTML = '';
    showSystemMessage('Loading photos...');

    db.ref(`photos/${code}`).once('value')
      .then((snapshot) => {
        const data = snapshot.val();
        if (!data) {
          showSystemMessage('No photos found for this code');
          return;
        }

        // Check if expired
        if (data.expires && data.expires < Date.now()) {
          showSystemMessage('This code has expired!');
          // Delete expired data
          db.ref(`photos/${code}`).remove();
          return;
        }

        currentViewerImages = [];
        // Display photos (skip the expires field)
        Object.keys(data).forEach(key => {
          if (key !== 'expires' && data[key]) {
            currentViewerImages.push(data[key]);
            const img = document.createElement('img');
            img.src = data[key];
            img.alt = 'Shared photo';
            img.dataset.index = currentViewerImages.length - 1;
            img.addEventListener('click', () => {
              openFullscreenViewer(currentViewerImages, parseInt(img.dataset.index));
            });
            viewerGallery.appendChild(img);
          }
        });

        if (viewerGallery.children.length === 0) {
          showSystemMessage('No photos found for this code');
        } else {
          hideSystemMessage();
        }
      })
      .catch((error) => {
        console.error('Error loading photos:', error);
        showSystemMessage('No photos found for this code');
      });
  }

  // Fullscreen viewer functions
  function openFullscreenViewer(images, index) {
    currentViewerImages = images;
    currentFullscreenIndex = index;
    fullscreenImage.src = images[index];
    fullscreenViewer.classList.add('active');
    document.body.style.overflow = 'hidden';
  }

  function closeFullscreenViewer() {
    fullscreenViewer.classList.remove('active');
    document.body.style.overflow = '';
  }

  function showPrevImage() {
    currentFullscreenIndex = (currentFullscreenIndex - 1 + currentViewerImages.length) % currentViewerImages.length;
    fullscreenImage.src = currentViewerImages[currentFullscreenIndex];
  }

  function showNextImage() {
    currentFullscreenIndex = (currentFullscreenIndex + 1) % currentViewerImages.length;
    fullscreenImage.src = currentViewerImages[currentFullscreenIndex];
  }

  // Keyboard navigation for fullscreen viewer
  document.addEventListener('keydown', (e) => {
    if (!fullscreenViewer.classList.contains('active')) return;
    
    if (e.key === 'Escape') {
      closeFullscreenViewer();
    } else if (e.key === 'ArrowLeft') {
      showPrevImage();
    } else if (e.key === 'ArrowRight') {
      showNextImage();
    }
  });

  // Check for code in URL
  function checkUrlForCode() {
    const urlParams = new URLSearchParams(window.location.search);
    const code = urlParams.get('code');
    if (code && code.length === 5 && /^\d+$/.test(code)) {
      // Switch to view tab and auto-load
      tabs.forEach(t => t.classList.remove('active'));
      tabContents.forEach(c => c.classList.remove('active'));
      document.querySelector('.tab[data-tab="view"]').classList.add('active');
      document.getElementById('view-tab').classList.add('active');
      
      codeInput.value = code;
      viewPhotos();
    }
  }

  // System message functions
  function showSystemMessage(msg) {
    systemMsg.textContent = msg;
    systemMsg.style.display = 'block';
    setTimeout(hideSystemMessage, 3000);
  }

  function hideSystemMessage() {
    systemMsg.style.display = 'none';
  }

  // Theme toggle functionality
  const themeToggle = document.getElementById('themeToggle');
  const body = document.body;

  const savedTheme = localStorage.getItem('theme') || 
                   (window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark');

  if (savedTheme === 'light') {
    body.classList.add('light-mode');
    themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
  } else {
    themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
  }

  themeToggle.addEventListener('click', () => {
    body.classList.toggle('light-mode');
    
    if (body.classList.contains('light-mode')) {
      localStorage.setItem('theme', 'light');
      themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
    } else {
      localStorage.setItem('theme', 'dark');
      themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
    }
  });

  // Initialize
  checkUrlForCode();
</script>
