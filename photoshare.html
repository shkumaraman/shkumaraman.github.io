---
layout: default
title: "PhotoShare - Share Photos Privately"
description: "PhotoShare - Share photos privately with a unique code. Upload photos and share the code with friends to view."
---

<style>
:root {
    --dark-bg: #121212;
    --dark-header-bg: #181818;
    --dark-header-border: #2a2a2a;
    --dark-text: #fff;
    --dark-icon-color: #ccc;
    --dark-icon-hover-bg: rgba(255,255,255,0.1);
    --dark-secondary-text: #aaa;
    --dark-card-bg: #1e1e1e;
    --dark-card-border: #333;
    
    --light-bg: #f5f5f5;
    --light-header-bg: #ffffff;
    --light-header-border: #e0e0e0;
    --light-text: #333;
    --light-icon-color: #666;
    --light-icon-hover-bg: rgba(0,0,0,0.05);
    --light-secondary-text: #777;
    --light-card-bg: #fff;
    --light-card-border: #ddd;
    
    --brand-color: #25D366;
    --brand-hover: #1ebe5d;
}

* { box-sizing: border-box; }

html, body {
    overflow-x: hidden;
    height: 100%;
    margin: 0;
    padding: 0;
}

body {
    font-family: 'Segoe UI', sans-serif;
    background: var(--dark-bg);
    color: var(--dark-text);
    display: flex;
    flex-direction: column;
    min-height: 100vh;
    transition: background 0.3s, color 0.3s;
}

body.light-mode {
    background: var(--light-bg);
    color: var(--light-text);
}

.app-header {
    position: fixed !important;
    top: 0;
    left: 0;
    width: 100%;
    height: 50px;
    background: var(--dark-header-bg);
    padding: 8px 15px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 15px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.4);
    border-bottom: 1px solid var(--dark-header-border);
    z-index: 10000;
}

.light-mode .app-header {
    background: var(--light-header-bg);
    border-bottom: 1px solid var(--light-header-border);
}

.header-left, .header-right {
    display: flex;
    align-items: center;
    gap: 10px;
}

.logo { height: 40px; width: 40px; border-radius: 10px; }

.app-title { font-size: 1.1em; color: var(--dark-text); margin: 0; }
.light-mode .app-title { color: var(--light-text); }

.btn-primary, .btn-secondary {
    background: var(--brand-color);
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 30px;
    cursor: pointer;
    font-size: 1em;
    font-weight: bold;
    transition: all 0.3s;
}

.btn-primary:hover, .btn-secondary:hover {
    background: var(--brand-hover);
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}

.btn-primary:disabled, .btn-secondary:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
}

.theme-toggle {
    background: none;
    border: none;
    color: var(--dark-icon-color);
    font-size: 1.1em;
    cursor: pointer;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: all 0.3s;
}

.theme-toggle:hover { background: var(--dark-icon-hover-bg); }
.light-mode .theme-toggle { color: var(--light-icon-color); }
.light-mode .theme-toggle:hover { background: var(--light-icon-hover-bg); }

.container {
    max-width: 1000px;
    padding: 60px 10px 0 10px;
    flex: 1;
    width: 100%;
}

.tab-bar {
    display: flex;
    width: 100%;
    margin: 0 0 20px 0;
    background: var(--dark-card-bg);
    border-radius: 8px;
    border: 1px solid var(--dark-card-border);
    overflow: hidden;
}

.light-mode .tab-bar {
    background: var(--light-card-bg);
    border: 1px solid var(--light-card-border);
}

.tab-btn {
    flex: 1;
    padding: 8px 0;
    text-align: center;
    font-size: 1.1em;
    font-weight: 600;
    background: transparent;
    border: none;
    color: var(--dark-secondary-text);
    cursor: pointer;
    transition: all 0.2s;
}

.tab-btn.active {
    color: var(--dark-text);
    border-bottom: 2px solid var(--brand-color);
    background: rgba(37, 211, 102, 0.1);
}

.light-mode .tab-btn {
    color: var(--light-secondary-text);
}

.light-mode .tab-btn.active {
    color: var(--light-text);
    background: rgba(37, 211, 102, 0.05);
}

.tab-content {
    display: none;
    animation: fadeIn 0.4s ease;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.tab-content.active { display: block; }

.upload-area {
    border: 2px dashed var(--dark-header-border);
    border-radius: 15px;
    padding: 40px 30px;
    text-align: center;
    margin-bottom: 25px;
    cursor: pointer;
    transition: all 0.3s;
    background: var(--dark-header-bg);
}

.light-mode .upload-area {
    border-color: var(--light-header-border);
    background: var(--light-header-bg);
}

.upload-area:hover {
    border-color: var(--brand-color);
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
}

.upload-area i { font-size: 48px; margin-bottom: 15px; color: var(--brand-color); }
.upload-area h3 { margin: 0 0 8px; font-size: 1.3em; }
.upload-area p { margin: 0; color: var(--dark-secondary-text); font-size: 0.95em; }
.light-mode .upload-area p { color: var(--light-secondary-text); }

.photo-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
    gap: 10px;
    margin-bottom: 25px;
}

.grid-item {
    position: relative;
    width: 100%;
    aspect-ratio: 1;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    transition: transform 0.3s;
    cursor: pointer;
}

.grid-item:hover { transform: translateY(-4px); }

.grid-item img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.grid-item .remove-btn {
    position: absolute;
    top: 6px;
    right: 6px;
    background: rgba(255,0,0,0.8);
    color: white;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s;
    font-size: 0.8em;
}

.grid-item .remove-btn:hover {
    background: rgba(255,0,0,1);
    transform: scale(1.1);
}

.progress-wrap {
    display: none;
    margin-bottom: 20px;
}

.progress-wrap.active { display: block; }

.progress-label {
    font-size: 0.9em;
    color: var(--dark-secondary-text);
    margin-bottom: 8px;
    text-align: center;
}

.light-mode .progress-label { color: var(--light-secondary-text); }

.progress-bar {
    width: 100%;
    height: 6px;
    background: var(--dark-header-border);
    border-radius: 10px;
    overflow: hidden;
}

.light-mode .progress-bar { background: var(--light-header-border); }

.progress-fill {
    height: 100%;
    background: var(--brand-color);
    border-radius: 10px;
    transition: width 0.3s ease;
    width: 0%;
}

.code-display {
    font-size: 2.2em;
    font-weight: bold;
    letter-spacing: 5px;
    text-align: center;
    margin: 25px 0;
    padding: 20px;
    background: rgba(0,0,0,0.2);
    border-radius: 12px;
    box-shadow: inset 0 0 10px rgba(0,0,0,0.2);
    font-family: 'Courier New', monospace;
}

.light-mode .code-display { background: rgba(0,0,0,0.05); }

.viewer-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
}

.viewer-input {
    display: flex;
    gap: 12px;
    margin-bottom: 25px;
    width: 100%;
    max-width: 500px;
}

.viewer-input input {
    flex: 1;
    padding: 14px 18px;
    border-radius: 30px;
    border: none;
    text-align: center;
    font-size: 1.05em;
    background: var(--dark-header-bg);
    color: var(--dark-text);
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    transition: all 0.3s;
}

.viewer-input input:focus {
    outline: none;
    box-shadow: 0 0 0 2px var(--brand-color);
}

.light-mode .viewer-input input {
    background: var(--light-header-bg);
    color: var(--light-text);
}

.share-buttons {
    display: flex;
    gap: 15px;
    justify-content: center;
    margin: 20px 0;
}

@media (max-width: 600px) {
    .share-buttons {
        flex-direction: column;
        gap: 10px;
        width: 100%;
    }
    
    .share-buttons .btn-secondary {
        width: 100%;
        margin: 0;
    }
}

.fullscreen-viewer {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.92);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2000;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s;
}

.fullscreen-viewer.active {
    opacity: 1;
    pointer-events: all;
}

.fullscreen-viewer img {
    max-width: 85%;
    max-height: 85%;
    object-fit: contain;
    border-radius: 8px;
    user-select: none;
}

.close-btn {
    position: absolute;
    top: 60px;
    right: 20px;
    background: rgba(255,255,255,0.2);
    color: white;
    border: none;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    font-size: 1.2em;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s;
}

.close-btn:hover {
    background: rgba(255,255,255,0.35);
    transform: rotate(90deg);
}

.nav-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(255,255,255,0.15);
    color: white;
    border: none;
    width: 44px;
    height: 44px;
    border-radius: 50%;
    font-size: 1.3em;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.2s;
}

.nav-btn:hover { background: rgba(255,255,255,0.3); }
.nav-btn.prev { left: 15px; }
.nav-btn.next { right: 15px; }
.nav-btn:disabled { opacity: 0.2; cursor: default; }

.fs-counter {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    color: rgba(255,255,255,0.7);
    font-size: 0.9em;
}

.system-msg {
    position: fixed;
    top: 70px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0,0,0,0.85);
    color: white;
    padding: 12px 24px;
    border-radius: 10px;
    text-align: center;
    z-index: 9999;
    display: none;
    font-size: 0.95em;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    white-space: nowrap;
    animation: fadeIn 0.3s ease;
}

@media (max-width: 600px) {
    .tab-btn { padding: 6px 0; font-size: 1em; }
    .photo-grid { grid-template-columns: repeat(auto-fill, minmax(90px, 1fr)); }
    .code-display { font-size: 1.8em; padding: 15px; }
    .share-buttons { flex-direction: column; align-items: center; width: 100%; }
    .share-buttons .btn-secondary { width: 100%; margin: 0; }
    .viewer-input { flex-direction: column; }
    .header-right { gap: 5px; }
    .nav-btn { width: 36px; height: 36px; font-size: 1em; }
    .nav-btn.prev { left: 8px; }
    .nav-btn.next { right: 8px; }
}
</style>

  <header class="app-header">
    <div class="header-left">
      <button class="menu-btn" onclick="toggleMenu()">&#9776;</button>
      <img src="photo-gallery.png" alt="PhotoShare Logo" class="logo">
      <h1 class="app-title">PhotoShare</h1>
    </div>
    <div class="header-right">
      <button class="theme-toggle" id="themeToggle" title="Toggle Dark/Light Mode">
        <i class="fas fa-moon"></i>
      </button>
    </div>
  </header>

  <div class="container">
    <div class="tab-bar">
      <button class="tab-btn active" id="tabUpload">Upload Photos</button>
      <button class="tab-btn" id="tabView">View Photos</button>
    </div>

    <div class="tab-content active" id="upload-tab">
      <div class="upload-area" id="uploadArea">
        <i class="fas fa-cloud-upload-alt"></i>
        <h3>Click to Upload Photos</h3>
        <p>Select up to 10 photos to share</p>
        <input type="file" id="fileInput" accept="image/*" multiple style="display: none;">
      </div>

      <div class="photo-grid" id="previewContainer"></div>

      <div class="progress-wrap" id="progressWrap">
        <div class="progress-label" id="progressLabel">Uploading 1 of 3...</div>
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
      </div>

      <button class="btn-primary" id="generateBtn" style="display: none; width: 100%;">Generate Share Code</button>

      <div class="code-display" id="codeDisplay" style="display: none;"></div>

      <div class="share-buttons" id="shareButtons" style="display: none;">
        <button class="btn-secondary" id="copyBtn"><i class="fas fa-copy"></i> Copy Code</button>
        <button class="btn-secondary" id="shareBtn"><i class="fas fa-share-alt"></i> Share</button>
      </div>
    </div>

    <div class="tab-content" id="view-tab">
      <div class="viewer-container">
        <div class="viewer-input">
          <input type="text" id="codeInput" placeholder="Enter 5-digit code" maxlength="5">
          <button class="btn-primary" id="viewBtn">View</button>
        </div>
        <div class="photo-grid" id="viewerGallery"></div>
      </div>
    </div>
  </div>

  <div class="fullscreen-viewer" id="fullscreenViewer">
    <button class="close-btn" id="closeFullscreen"><i class="fas fa-times"></i></button>
    <button class="nav-btn prev" id="prevBtn"><i class="fas fa-chevron-left"></i></button>
    <img id="fullscreenImage" src="" alt="Fullscreen view">
    <button class="nav-btn next" id="nextBtn"><i class="fas fa-chevron-right"></i></button>
    <div class="fs-counter" id="fsCounter"></div>
  </div>

  <div class="system-msg" id="systemMsg"></div>

  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-7059052735946479"
       data-ad-slot="8592327962"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>

<main class="info-section" style="padding: 20px; max-width: 800px; margin: 0 auto;">
  <h2>Private Photo Sharing – Auto Delete in 24 Hours</h2>
  <p>Upload your photos securely and receive a unique <strong>5-digit code</strong>. Share this code with your friends or send it via WhatsApp. Only the person who enters the code can view your photos. For your privacy, photos will be <strong>automatically deleted after 24 hours</strong>.</p>

  <h2>How It Works</h2>
  <ol>
    <li><strong>Upload</strong> – Choose up to 10 photos from your device. No sign-up or registration required.</li>
    <li><strong>Get a Code</strong> – A unique 5-digit code is generated instantly (e.g., 48291).</li>
    <li><strong>Share</strong> – Copy the code or send it directly via WhatsApp or any other messenger.</li>
    <li><strong>View</strong> – Only people with the code can see your photos.</li>
    <li><strong>Auto-Delete</strong> – Your photos will be permanently removed after 24 hours.</li>
  </ol>

  <h2>Why Choose This Service?</h2>
  <ul>
    <li>No account or personal information required</li>
    <li>Fast and easy photo sharing</li>
    <li>Secure and private – you control who sees your photos</li>
    <li>Automatic deletion after 24 hours for extra privacy</li>
    <li>Works on any device – phone, tablet, or computer</li>
  </ul>

  <p style="font-size:0.9em; color:#555;">
    <strong>Note:</strong> Share your code only with people you trust. We never store your photos beyond 24 hours.
  </p>
</main>

  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-7059052735946479"
       data-ad-slot="8592327962"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>

{% include scripts.html %}
{% include menu.html %}

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
  import { getDatabase, ref, set, get, remove } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

  const firebaseConfig = {
    databaseURL: "https://talkrush-76259-default-rtdb.asia-southeast1.firebasedatabase.app/"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  let IMGBB_API_KEY = '';

  async function loadKeys() {
    const res = await fetch('/key.json');
    const keys = await res.json();
    IMGBB_API_KEY = keys.imgbb;
  }

  async function uploadToImgBB(dataUrl) {
    const base64 = dataUrl.split(',')[1];
    const formData = new FormData();
    formData.append('image', base64);
    formData.append('expiration', '86400');
    const response = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, {
      method: 'POST',
      body: formData
    });
    if (!response.ok) throw new Error('ImgBB upload failed');
    const data = await response.json();
    if (!data.success) throw new Error('ImgBB upload unsuccessful');
    return data.data.url;
  }

  const uploadArea = document.getElementById('uploadArea');
  const fileInput = document.getElementById('fileInput');
  const previewContainer = document.getElementById('previewContainer');
  const generateBtn = document.getElementById('generateBtn');
  const codeDisplay = document.getElementById('codeDisplay');
  const shareButtons = document.getElementById('shareButtons');
  const copyBtn = document.getElementById('copyBtn');
  const shareBtn = document.getElementById('shareBtn');
  const codeInput = document.getElementById('codeInput');
  const viewBtn = document.getElementById('viewBtn');
  const viewerGallery = document.getElementById('viewerGallery');
  const systemMsg = document.getElementById('systemMsg');
  const tabUpload = document.getElementById('tabUpload');
  const tabView = document.getElementById('tabView');
  const uploadTab = document.getElementById('upload-tab');
  const viewTab = document.getElementById('view-tab');
  const fullscreenViewer = document.getElementById('fullscreenViewer');
  const fullscreenImage = document.getElementById('fullscreenImage');
  const closeFullscreen = document.getElementById('closeFullscreen');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  const fsCounter = document.getElementById('fsCounter');
  const progressWrap = document.getElementById('progressWrap');
  const progressLabel = document.getElementById('progressLabel');
  const progressFill = document.getElementById('progressFill');

  const MAX_IMAGES = 10;
  let uploadedFiles = [];
  let shareCode = '';
  let fsImages = [];
  let fsIndex = 0;
  let msgTimer = null;

  uploadArea.addEventListener('click', () => fileInput.click());
  fileInput.addEventListener('change', handleFileSelect);
  generateBtn.addEventListener('click', generateShareCode);
  copyBtn.addEventListener('click', copyCode);
  shareBtn.addEventListener('click', shareCodeViaAPI);
  viewBtn.addEventListener('click', viewPhotos);
  closeFullscreen.addEventListener('click', closeFs);
  prevBtn.addEventListener('click', () => navigateFs(-1));
  nextBtn.addEventListener('click', () => navigateFs(1));

  tabUpload.addEventListener('click', () => {
    tabUpload.classList.add('active');
    tabView.classList.remove('active');
    uploadTab.classList.add('active');
    viewTab.classList.remove('active');
  });

  tabView.addEventListener('click', () => {
    tabView.classList.add('active');
    tabUpload.classList.remove('active');
    viewTab.classList.add('active');
    uploadTab.classList.remove('active');
  });

  uploadArea.addEventListener('dragover', (e) => {
    e.preventDefault();
    uploadArea.style.borderColor = 'var(--brand-color)';
    uploadArea.style.transform = 'translateY(-3px)';
  });

  uploadArea.addEventListener('dragleave', () => {
    uploadArea.style.borderColor = '';
    uploadArea.style.transform = '';
  });

  uploadArea.addEventListener('drop', (e) => {
    e.preventDefault();
    uploadArea.style.borderColor = '';
    uploadArea.style.transform = '';
    if (e.dataTransfer.files.length) processFiles(Array.from(e.dataTransfer.files));
  });

  function resizeImage(file, maxWidth, maxHeight, quality) {
    return new Promise((resolve) => {
      const reader = new FileReader();
      reader.onload = (event) => {
        const img = new Image();
        img.onload = () => {
          const canvas = document.createElement('canvas');
          let w = img.width, h = img.height;
          if (w > h) { if (w > maxWidth) { h *= maxWidth / w; w = maxWidth; } }
          else { if (h > maxHeight) { w *= maxHeight / h; h = maxHeight; } }
          canvas.width = w;
          canvas.height = h;
          canvas.getContext('2d').drawImage(img, 0, 0, w, h);
          resolve(canvas.toDataURL('image/jpeg', quality));
        };
        img.src = event.target.result;
      };
      reader.readAsDataURL(file);
    });
  }

  function handleFileSelect(event) {
    processFiles(Array.from(event.target.files));
  }

  function processFiles(files) {
    const remaining = MAX_IMAGES - uploadedFiles.length;
    if (remaining <= 0) { showMsg(`Maximum ${MAX_IMAGES} photos allowed`); return; }
    const toAdd = files.slice(0, remaining);
    if (files.length > remaining) showMsg(`Only ${remaining} more photo(s) can be added`);

    toAdd.forEach(file => {
      if (!file.type.startsWith('image/')) { showMsg(`${file.name} is not an image`); return; }
      if (file.size > 10 * 1024 * 1024) { showMsg(`${file.name} is too large (max 10MB)`); return; }

      const idx = uploadedFiles.length;
      uploadedFiles.push(file);

      const reader = new FileReader();
      reader.onload = (e) => {
        const item = document.createElement('div');
        item.className = 'grid-item';
        item.dataset.index = idx;
        item.innerHTML = `<img src="${e.target.result}" alt="Preview"><div class="remove-btn"><i class="fas fa-times"></i></div>`;

        item.querySelector('img').addEventListener('click', () => {
          const allPreviews = [...previewContainer.querySelectorAll('.grid-item img')].map(i => i.src);
          openFs(allPreviews, parseInt(item.dataset.index));
        });

        item.querySelector('.remove-btn').addEventListener('click', (ev) => {
          ev.stopPropagation();
          uploadedFiles.splice(parseInt(item.dataset.index), 1);
          item.remove();
          updateIndices();
          if (uploadedFiles.length === 0) generateBtn.style.display = 'none';
        });

        previewContainer.appendChild(item);
      };
      reader.readAsDataURL(file);
    });

    if (uploadedFiles.length > 0) generateBtn.style.display = 'block';
    fileInput.value = '';
  }

  function updateIndices() {
    previewContainer.querySelectorAll('.grid-item').forEach((item, i) => { item.dataset.index = i; });
  }

  async function generateShareCode() {
    if (uploadedFiles.length === 0) { showMsg('Please upload at least one photo'); return; }

    await loadKeys();

    generateBtn.disabled = true;
    generateBtn.textContent = 'Uploading...';
    progressWrap.classList.add('active');
    progressFill.style.width = '0%';

    try {
      const urls = [];
      const total = uploadedFiles.length;

      for (let i = 0; i < total; i++) {
        progressLabel.textContent = `Uploading ${i + 1} of ${total}...`;
        progressFill.style.width = `${(i / total) * 100}%`;
        const resized = await resizeImage(uploadedFiles[i], 1600, 1600, 0.80);
        const url = await uploadToImgBB(resized);
        urls.push(url);
        progressFill.style.width = `${((i + 1) / total) * 100}%`;
      }

      shareCode = Math.floor(10000 + Math.random() * 90000).toString();
      await set(ref(db, `photos/${shareCode}/images`), urls);
      await set(ref(db, `photos/${shareCode}/expires`), Date.now() + 24 * 60 * 60 * 1000);

      progressWrap.classList.remove('active');
      generateBtn.style.display = 'none';

      codeDisplay.textContent = shareCode;
      codeDisplay.style.display = 'block';
      shareButtons.style.display = 'flex';

      showMsg('Photos uploaded! Share the code below.');
    } catch (error) {
      progressWrap.classList.remove('active');
      generateBtn.disabled = false;
      generateBtn.textContent = 'Generate Share Code';
      showMsg('Error uploading. Please try again.');
    }
  }

  function copyCode() {
    navigator.clipboard.writeText(shareCode)
      .then(() => showMsg('Code copied!'))
      .catch(() => showMsg('Failed to copy'));
  }

  function shareCodeViaAPI() {
    const url = `${window.location.href.split('?')[0]}?code=${shareCode}`;
    if (navigator.share) {
      navigator.share({ title: 'PhotoShare Code', text: `Use code ${shareCode} on PhotoShare`, url }).catch(() => copyCode());
    } else {
      copyCode();
    }
  }

  async function viewPhotos() {
    const code = codeInput.value.trim();
    if (code.length !== 5 || !/^\d+$/.test(code)) { showMsg('Please enter a valid 5-digit code'); return; }

    viewerGallery.innerHTML = '';
    viewBtn.disabled = true;
    viewBtn.textContent = 'Loading...';

    try {
      const snapshot = await get(ref(db, `photos/${code}`));
      const data = snapshot.val();

      viewBtn.disabled = false;
      viewBtn.textContent = 'View';

      if (!data) { showMsg('No photos found for this code'); return; }

      if (data.expires && data.expires < Date.now()) {
        showMsg('This code has expired!');
        remove(ref(db, `photos/${code}`));
        return;
      }

      const images = data.images || (data.image ? [data.image] : null);
      if (!images || images.length === 0) { showMsg('No photos found for this code'); return; }

      images.forEach((src, idx) => {
        const item = document.createElement('div');
        item.className = 'grid-item';
        const img = document.createElement('img');
        img.src = src;
        img.alt = `Photo ${idx + 1}`;
        img.loading = 'lazy';
        item.appendChild(img);
        item.addEventListener('click', () => openFs(images, idx));
        viewerGallery.appendChild(item);
      });
    } catch (error) {
      viewBtn.disabled = false;
      viewBtn.textContent = 'View';
      showMsg('No photos found for this code');
    }
  }

  function openFs(images, index) {
    fsImages = images;
    fsIndex = index;
    renderFs();
    fullscreenViewer.classList.add('active');
    document.body.style.overflow = 'hidden';
  }

  function renderFs() {
    fullscreenImage.src = fsImages[fsIndex];
    const multiple = fsImages.length > 1;
    fsCounter.textContent = multiple ? `${fsIndex + 1} / ${fsImages.length}` : '';
    prevBtn.style.display = multiple ? 'flex' : 'none';
    nextBtn.style.display = multiple ? 'flex' : 'none';
    prevBtn.disabled = fsIndex === 0;
    nextBtn.disabled = fsIndex === fsImages.length - 1;
  }

  function navigateFs(dir) {
    const n = fsIndex + dir;
    if (n < 0 || n >= fsImages.length) return;
    fsIndex = n;
    renderFs();
  }

  function closeFs() {
    fullscreenViewer.classList.remove('active');
    document.body.style.overflow = '';
  }

  document.addEventListener('keydown', (e) => {
    if (!fullscreenViewer.classList.contains('active')) return;
    if (e.key === 'Escape') closeFs();
    if (e.key === 'ArrowLeft') navigateFs(-1);
    if (e.key === 'ArrowRight') navigateFs(1);
  });

  function showMsg(msg) {
    clearTimeout(msgTimer);
    systemMsg.textContent = msg;
    systemMsg.style.display = 'block';
    msgTimer = setTimeout(() => { systemMsg.style.display = 'none'; }, 3000);
  }

  function checkUrlForCode() {
    const urlParams = new URLSearchParams(window.location.search);
    const code = urlParams.get('code');
    if (code && code.length === 5 && /^\d+$/.test(code)) {
      tabUpload.classList.remove('active');
      tabView.classList.add('active');
      uploadTab.classList.remove('active');
      viewTab.classList.add('active');
      codeInput.value = code;
      viewPhotos();
    }
  }

  checkUrlForCode();
</script>
