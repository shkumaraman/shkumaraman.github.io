---
layout: default
title: "User Profile - TalkRush"
description: "View user profile and send messages"
---

<style>
:root {
  --dark-bg: #121212;
  --dark-header-bg: #181818;
  --dark-header-border: #2a2a2a;
  --dark-card-bg: #1e1e1e;
  --dark-text: #fff;
  --dark-secondary-text: #aaa;
  --dark-input-bg: #333;
  --dark-btn-bg: #4CAF50;
  --dark-btn-hover: #45a049;
  --light-bg: #f5f5f5;
  --light-header-bg: #ffffff;
  --light-header-border: #e0e0e0;
  --light-card-bg: #f9f9f9;
  --light-text: #333;
  --light-secondary-text: #666;
  --light-input-bg: #e0e0e0;
  --light-btn-bg: #4CAF50;
  --light-btn-hover: #45a049;
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: 'Segoe UI', sans-serif;
  background: var(--dark-bg);
  color: var(--dark-text);
  min-height: 100vh;
  transition: background 0.3s, color 0.3s;
}

body.light-mode {
  background: var(--light-bg);
  color: var(--light-text);
}

.app-header {
  background: var(--dark-header-bg);
  padding: 15px 20px;
  display: flex;
  align-items: center;
  gap: 15px;
  border-bottom: 1px solid var(--dark-header-border);
  position: fixed;
  top: 0;
  width: 100%;
  z-index: 1000;
}

.light-mode .app-header {
  background: var(--light-header-bg);
  border-bottom: 1px solid var(--light-header-border);
}

.back-btn {
  background: none;
  border: none;
  color: var(--dark-text);
  font-size: 1.2em;
  cursor: pointer;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background 0.3s;
}

.back-btn:hover {
  background: rgba(255,255,255,0.1);
}

.light-mode .back-btn {
  color: var(--light-text);
}

.light-mode .back-btn:hover {
  background: rgba(0,0,0,0.05);
}

.app-title {
  font-size: 1.2em;
  color: var(--dark-text);
}

.light-mode .app-title {
  color: var(--light-text);
}

.profile-container {
  max-width: 600px;
  margin: 80px auto 20px;
  padding: 20px;
}

.profile-card {
  background: var(--dark-card-bg);
  border-radius: 15px;
  padding: 30px;
  text-align: center;
  box-shadow: 0 4px 6px rgba(0,0,0,0.3);
}

.light-mode .profile-card {
  background: var(--light-card-bg);
  box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}

.profile-avatar {
  width: 150px;
  height: 150px;
  border-radius: 50%;
  margin: 0 auto 20px;
  overflow: hidden;
  border: 4px solid var(--dark-btn-bg);
}

.profile-avatar img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.profile-name {
  font-size: 2em;
  margin-bottom: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.verify-badge {
  width: 24px;
  height: 24px;
}

.user-status {
  color: var(--dark-secondary-text);
  margin-bottom: 20px;
  font-size: 1.1em;
}

.light-mode .user-status {
  color: var(--light-secondary-text);
}

.user-bio {
  margin: 20px 0;
  padding: 15px;
  background: var(--dark-input-bg);
  border-radius: 10px;
  text-align: left;
}

.light-mode .user-bio {
  background: var(--light-input-bg);
}

.user-bio h3 {
  margin-bottom: 10px;
  color: var(--dark-btn-bg);
}

.user-stats {
  display: flex;
  justify-content: center;
  gap: 30px;
  margin: 20px 0;
  padding: 15px 0;
  border-top: 1px solid var(--dark-header-border);
  border-bottom: 1px solid var(--dark-header-border);
}

.light-mode .user-stats {
  border-color: var(--light-header-border);
}

.stat-item {
  text-align: center;
}

.stat-value {
  font-size: 1.5em;
  font-weight: bold;
  color: var(--dark-btn-bg);
}

.stat-label {
  font-size: 0.9em;
  color: var(--dark-secondary-text);
}

.light-mode .stat-label {
  color: var(--light-secondary-text);
}

.message-btn {
  background: var(--dark-btn-bg);
  color: white;
  border: none;
  padding: 15px 30px;
  border-radius: 30px;
  font-size: 1.1em;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  gap: 10px;
  transition: background 0.3s;
  margin-top: 20px;
}

.message-btn:hover {
  background: var(--dark-btn-hover);
}

.light-mode .message-btn {
  background: var(--light-btn-bg);
}

.light-mode .message-btn:hover {
  background: var(--light-btn-hover);
}

.loading {
  text-align: center;
  padding: 50px;
  color: var(--dark-secondary-text);
}

@media (max-width: 600px) {
  .profile-container {
    padding: 10px;
  }
  
  .profile-card {
    padding: 20px;
  }
  
  .profile-avatar {
    width: 120px;
    height: 120px;
  }
  
  .profile-name {
    font-size: 1.5em;
  }
}
</style>

<div class="app-header">
  <button class="back-btn" onclick="goBack()" title="Go Back">
    <i class="fas fa-arrow-left"></i>
  </button>
  <h1 class="app-title">User Profile</h1>
</div>

<div class="profile-container" id="profileContainer">
  <div class="loading">
    <i class="fas fa-spinner fa-spin"></i> Loading profile...
  </div>
</div>

<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-7059052735946479"
     data-ad-slot="8592327962"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

{% include menu.html %}
{% include scripts.html %}

<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js';
import { getDatabase, ref, get, query, orderByChild, equalTo } from 'https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js';

const firebaseConfig = {
  databaseURL: "https://talkrush-76259-default-rtdb.asia-southeast1.firebasedatabase.app/"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// Get nickname from URL
const urlParams = new URLSearchParams(window.location.search);
const nickname = urlParams.get('user');
const group = urlParams.get('group');

async function loadUserProfile() {
  if (!nickname) {
    showError('No user specified');
    return;
  }
  
  try {
    const groups = ['General', 'Dating', 'Singles', 'Sports', 'Tech', 'Gaming', 'Music'];
    let userMessages = [];
    let userGroups = new Set();
    let lastSeen = null;
    let avatarUrl = '/assets/default-avatar.png';
    
    for (const groupName of groups) {
      const messagesRef = ref(db, `groups/${groupName}/messages`);
      const messagesQuery = query(messagesRef, orderByChild('nickname'), equalTo(nickname));
      const snapshot = await get(messagesQuery);
      
      if (snapshot.exists()) {
        const messages = snapshot.val();
        Object.values(messages).forEach(msg => {
          userMessages.push(msg);
          userGroups.add(groupName);
          if (!lastSeen || msg.timestamp > lastSeen) {
            lastSeen = msg.timestamp;
          }
          // Check if user has custom avatar in their messages
          if (msg.avatar) {
            avatarUrl = msg.avatar;
          }
        });
      }
    }
    
    // Check if user is admin
    let isAdmin = false;
    for (const groupName of groups) {
      const adminRef = ref(db, `groups/${groupName}/admin`);
      const adminSnapshot = await get(adminRef);
      if (adminSnapshot.val() === nickname) {
        isAdmin = true;
        break;
      }
    }
    
    displayProfile({
      nickname,
      avatar: avatarUrl,
      isAdmin,
      messageCount: userMessages.length,
      groups: Array.from(userGroups),
      lastSeen,
      bio: `Active in ${userGroups.size} group${userGroups.size !== 1 ? 's' : ''}`
    });
    
  } catch (error) {
    console.error('Error loading profile:', error);
    showError('Failed to load profile');
  }
}

function displayProfile(user) {
  const container = document.getElementById('profileContainer');
  const lastSeen = user.lastSeen ? new Date(user.lastSeen).toLocaleString() : 'Unknown';
  
  container.innerHTML = `
    <div class="profile-card">
      <div class="profile-avatar">
        <img src="${user.avatar}" alt="${user.nickname}" onerror="this.src='/assets/default-avatar.png'">
      </div>
      
      <h1 class="profile-name">
        ${user.nickname}
        ${user.isAdmin ? '<img src="/assets/verify.png" class="verify-badge" alt="Verified Admin">' : ''}
      </h1>
      
      <div class="user-status">
        <i class="fas fa-circle" style="color: #4CAF50; font-size: 0.8em;"></i> Online now
      </div>
      
      <div class="user-stats">
        <div class="stat-item">
          <div class="stat-value">${user.messageCount}</div>
          <div class="stat-label">Messages</div>
        </div>
        <div class="stat-item">
          <div class="stat-value">${user.groups.length}</div>
          <div class="stat-label">Groups</div>
        </div>
        <div class="stat-item">
          <div class="stat-value">âš¡</div>
          <div class="stat-label">Active</div>
        </div>
      </div>
      
      <div class="user-bio">
        <h3><i class="fas fa-info-circle"></i> About</h3>
        <p>${user.bio}</p>
        <p style="margin-top: 10px; color: var(--dark-secondary-text);">
          <i class="fas fa-clock"></i> Last seen: ${lastSeen}
        </p>
        <p style="margin-top: 5px;">
          <i class="fas fa-users"></i> Active in: ${user.groups.join(', ')}
        </p>
      </div>
      
      <button class="message-btn" onclick="sendMessageToUser('${user.nickname}')">
        <i class="fas fa-comment"></i> Send Message
      </button>
    </div>
  `;
}

function showError(message) {
  const container = document.getElementById('profileContainer');
  container.innerHTML = `
    <div class="profile-card" style="text-align: center; color: #ff6b6b;">
      <i class="fas fa-exclamation-circle" style="font-size: 50px; margin-bottom: 20px;"></i>
      <h2>${message}</h2>
      <button class="message-btn" onclick="goBack()" style="margin-top: 20px;">
        <i class="fas fa-arrow-left"></i> Go Back
      </button>
    </div>
  `;
}

window.goBack = function() {
  if (group) {
    window.location.href = `/chat/group.html?group=${encodeURIComponent(group)}`;
  } else {
    window.location.href = '/chat/rooms.html';
  }
};

window.sendMessageToUser = function(targetUser) {
  if (group) {
    window.location.href = `/chat/group.html?group=${encodeURIComponent(group)}&to=${encodeURIComponent(targetUser)}`;
  } else {
    window.location.href = `/chat/rooms.html?to=${encodeURIComponent(targetUser)}`;
  }
};
  
loadUserProfile();
</script>
