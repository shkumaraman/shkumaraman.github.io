<!-- PeerJS -->
<script src="https://unpkg.com/peerjs@1.5.5/dist/peerjs.min.js"></script>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap/dist/js/bootstrap.bundle.min.js"></script> 

<!-- Firebase (compat version) -->
<script src="https://www.gstatic.com/firebasejs/12.1.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.1.0/firebase-database-compat.js"></script>

<script>
// ----------------- Theme Toggle -----------------
const themeToggle = document.getElementById('themeToggle');
const body = document.body;

// Load theme from localStorage or system preference
const savedTheme = localStorage.getItem('theme') ||
                   (window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark');

if (savedTheme === 'light') {
  body.classList.add('light-mode');
  themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
} else {
  themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
}

themeToggle.addEventListener('click', () => {
  body.classList.toggle('light-mode');
  if (body.classList.contains('light-mode')) {
    localStorage.setItem('theme', 'light');
    themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
  } else {
    localStorage.setItem('theme', 'dark');
    themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
  }
});

// ----------------- Chat Layout + Input Focus Handling -----------------
const msgInput = document.getElementById("msgInput");
const chatLog = document.getElementById("chatLog");
const chatControls = document.querySelector(".chat-controls");
const appHeader = document.querySelector(".app-header");

// Set chatLog height based on viewport and layout
function setChatLogHeight() {
  const windowHeight = window.innerHeight;
  const headerHeight = appHeader.offsetHeight;
  const controlsHeight = chatControls.offsetHeight;
  
  const availableHeight = windowHeight - headerHeight - controlsHeight;
  chatLog.style.height = availableHeight + "px";
}

// Set height on load
setChatLogHeight();

// Recalculate height on window resize
window.addEventListener("resize", setChatLogHeight);

// Lock body scroll when input is focused (mobile UX)
msgInput.addEventListener("focus", () => {
  document.body.style.overflow = "hidden";
});

// Restore scroll when input is blurred
msgInput.addEventListener("blur", () => {
  document.body.style.overflow = "auto";
});
</script>
