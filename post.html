---
layout: default
title: "Post Anonymously â€” Share Your Thoughts"
description: "Post anything anonymously without login. Confess, express, or speak your mind freely. No sign-up, 100% private & secure. Start posting now!"
---

<style>
    :root {
      /* Dark Theme Colors */
      --dark-bg: #121212;
      --dark-header-bg: #181818;
      --dark-header-border: #2a2a2a;
      --dark-chat-bg: #1e1e1e;
      --dark-msg-bg: #2b2b2b;
      --dark-msg-me: #007bff;
      --dark-text: #fff;
      --dark-secondary-text: #aaa;
      --dark-input-bg: #333;
      --dark-input-focus: #444;
      --dark-icon-color: #ccc;
      --dark-icon-hover-bg: rgba(255,255,255,0.1);

      /* Light Theme Colors */
      --light-bg: #f5f5f5;
      --light-header-bg: #ffffff;
      --light-header-border: #e0e0e0;
      --light-chat-bg: #f9f9f9;
      --light-msg-bg: #e9e9e9;
      --light-msg-me: #007bff;
      --light-text: #333;
      --light-secondary-text: #666;
      --light-input-bg: #e0e0e0;
      --light-input-focus: #d0d0d0;
      --light-icon-color: #666;
      --light-icon-hover-bg: rgba(0,0,0,0.05);

      /* Common Colors */
      --post-btn: #007bff;
      --post-btn-hover: #0056b3;
      --delete-btn: #dc3545;
      --share-btn: #25D366;
      --like-btn: #28a745;
      --dislike-btn: #6c757d;
    }

    * {
      box-sizing: border-box;
    }

    html, body {
      overflow-x: hidden;
    }
      
    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', sans-serif;
      background: var(--dark-bg);
      color: var(--dark-text);
      display: flex;
      flex-direction: column;
      height: 100vh;
      transition: background 0.3s, color 0.3s;
    }

    body.light-mode {
      background: var(--light-bg);
      color: var(--light-text);
    }

    .app-header {
      position: fixed !important;
      top: 0;
      left: 0;
      width: 100%;
      height: 50px;
      background: var(--dark-header-bg);
      padding: 8px 15px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 15px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.4);
      border-bottom: 1px solid var(--dark-header-border);
      z-index: 10000;
    }

    .light-mode .app-header {
      background: var(--light-header-bg);
      border-bottom: 1px solid var(--light-header-border);
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo {
      height: 40px;
      width: 40px;
      border-radius: 10px;
    }

    .app-title {
      font-size: 1em;
      color: var(--dark-text);
      margin: 0;
    }

    .light-mode .app-title {
      color: var(--light-text);
    }

    .share-btn {
      background: var(--share-btn);
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 0.9em;
      transition: background 0.2s;
    }

    .theme-toggle {
      background: none;
      border: none;
      color: var(--dark-icon-color);
      font-size: 1.1em;
      cursor: pointer;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: all 0.3s;
    }
      
    .theme-toggle:hover {
      background: var(--dark-icon-hover-bg);
    }

    .light-mode .theme-toggle {
      color: var(--light-icon-color);
    }

    .light-mode .theme-toggle:hover {
      background: var(--light-icon-hover-bg);
    }

    .posts-container {
      flex: 1;
      padding: 60px 10px 10px 10px;
      background: var(--dark-chat-bg);
    }

    .light-mode .posts-container {
      background: var(--light-chat-bg);
    }

    .post-input-container {
      background: var(--dark-msg-bg);
      margin: 10px auto;
      padding: 10px;
      border-radius: 15px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
      max-width: 600px;
      border: 1px solid rgba(255,255,255,0.1);
    }

    .light-mode .post-input-container {
      background: var(--light-msg-bg);
      border: 1px solid rgba(0,0,0,0.1);
    }

    .post-input-wrapper {
      position: relative;
    }

    .post-textarea {
      width: 100%;
      height: 120px;
      padding: 10px;
      font-size: 16px;
      box-sizing: border-box;
      resize: vertical;
      border: none;
      border-radius: 10px;
      font-family: inherit;
      outline: none;
      background: var(--dark-input-bg);
      color: var(--dark-text);
      transition: background 0.3s;
    }

    .post-textarea:focus {
      background: var(--dark-input-focus);
    }

    .light-mode .post-textarea {
      background: var(--light-input-bg);
      color: var(--light-text);
    }

    .light-mode .post-textarea:focus {
      background: var(--light-input-focus);
    }

    .post-button {
      position: absolute;
      bottom: 10px;
      right: 10px;
      padding: 8px 12px;
      font-size: 14px;
      cursor: pointer;
      background: var(--post-btn);
      color: white;
      border: none;
      border-radius: 15px;
      transition: background 0.2s;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .post-button:hover {
      background: var(--post-btn-hover);
    }

    .error-container {
      margin: 10px auto;
      max-width: 600px;
    }

    .error-message {
      background: rgba(220, 53, 69, 0.1);
      color: var(--error-color);
      padding: 10px 15px;
      border-radius: 10px;
      margin: 5px auto;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .success-message {
      background: rgba(40, 167, 69, 0.1);
      color: var(--success-color);
      padding: 10px 15px;
      border-radius: 10px;
      margin: 5px auto;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .light-mode .error-message {
      background: rgba(220, 53, 69, 0.15);
    }

    .light-mode .success-message {
      background: rgba(40, 167, 69, 0.15);
    }

    /* Post Styling */
    .post {
      background: var(--dark-msg-bg);
      margin: 10px auto;
      padding: 10px;
      border-radius: 15px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
      word-wrap: break-word;
      overflow-wrap: break-word;
      max-width: 600px;
      border: 1px solid rgba(255,255,255,0.1);
    }

    .light-mode .post {
      background: var(--light-msg-bg);
      color: var(--light-text);
      border: 1px solid rgba(0,0,0,0.1);
    }

    .nickname {
      font-weight: bold;
      color: var(--dark-text);
      margin-bottom: 8px;
      font-size: 0.95em;
    }

    .light-mode .nickname {
      color: var(--light-text);
    }

    .post-content {
      word-wrap: break-word;
      overflow-wrap: break-word;
      line-height: 1.4;
      margin-bottom: 10px;
    }

    .post-content a {
      color: var(--dark-msg-me);
      text-decoration: none;
    }

    .post-content a:hover {
      text-decoration: underline;
    }

    .light-mode .post-content a {
      color: var(--light-msg-me);
    }

    .timestamp {
      font-size: 0.75em;
      color: var(--dark-secondary-text);
      margin-bottom: 10px;
    }

    .light-mode .timestamp {
      color: var(--light-secondary-text);
    }

    .buttons {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .buttons button {
      padding: 6px 12px;
      border: none;
      border-radius: 15px;
      cursor: pointer;
      font-size: 0.85em;
      display: flex;
      align-items: center;
      gap: 5px;
      transition: all 0.2s;
    }

    .like-btn {
      background: var(--like-btn);
      color: white;
    }

    .like-btn:hover {
      opacity: 0.9;
    }

    .dislike-btn {
      background: var(--dislike-btn);
      color: white;
    }

    .dislike-btn:hover {
      opacity: 0.9;
    }

    .share-btn-post {
      background: var(--share-btn);
      color: white;
    }

    .share-btn-post:hover {
      opacity: 0.9;
    }

    .delete-btn {
      background: var(--delete-btn);
      color: white;
    }

    .delete-btn:hover {
      opacity: 0.9;
    }

    .system-msg {
      background: rgba(255, 193, 7, 0.1);
      color: var(--dark-text);
      padding: 10px 15px;
      border-radius: 10px;
      margin: 5px auto;
      font-style: italic;
      text-align: center;
      max-width: 600px;
    }

    .light-mode .system-msg {
      background: rgba(255, 193, 7, 0.2);
      color: var(--light-text);
    }

    .url-preview {
      margin: 10px 0;
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      overflow: hidden;
      background: rgba(255,255,255,0.05);
      word-wrap: break-word;
      overflow-wrap: break-word;
    }

    .light-mode .url-preview {
      border: 1px solid rgba(0,0,0,0.1);
      background: rgba(0,0,0,0.05);
    }

    .url-preview-content {
      padding: 12px;
    }

    .url-preview a {
      color: var(--dark-msg-me);
      text-decoration: none;
    }

    .url-preview a:hover {
      text-decoration: underline;
    }

    .light-mode .url-preview a {
      color: var(--light-msg-me);
    }

    .preview-title {
      font-weight: bold;
      margin-bottom: 5px;
      font-size: 0.9em;
      color: var(--dark-text);
      word-wrap: break-word;
      overflow-wrap: break-word;
    }

    .light-mode .preview-title {
      color: var(--light-text);
    }

    .preview-description {
      font-size: 0.8em;
      color: var(--dark-secondary-text);
      margin-bottom: 8px;
      line-height: 1.4;
      word-wrap: break-word;
      overflow-wrap: break-word;
    }

    .light-mode .preview-description {
      color: var(--light-secondary-text);
    }

    .preview-domain {
      font-size: 0.75em;
      color: var(--dark-secondary-text);
      margin-bottom: 8px;
      word-wrap: break-word;
      overflow-wrap: break-word;
    }

    .light-mode .preview-domain {
      color: var(--light-secondary-text);
    }

    .preview-image {
      width: 100%;
      max-height: 200px;
      object-fit: cover;
      border-radius: 4px;
      margin-top: 8px;
    }

    .preview-with-image {
      display: flex;
      gap: 12px;
      align-items: flex-start;
    }

    .preview-text-content {
      flex: 1;
      min-width: 0;
    }

    .preview-image-side {
      width: 80px;
      height: 80px;
      flex-shrink: 0;
    }

    .preview-image-side img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 4px;
    }

    .image-preview {
      margin: 10px 0;
      text-align: center;
    }

    .image-preview img {
      max-width: 100%;
      max-height: 300px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
      cursor: pointer;
      transition: transform 0.2s;
    }

    .image-preview img:hover {
      transform: scale(1.02);
    }

    .highlighted-post {
      border: 2px solid var(--dark-msg-me);
      background-color: rgba(0, 123, 255, 0.1);
      animation: pulse 2s infinite;
    }

    .light-mode .highlighted-post {
      border: 2px solid var(--light-msg-me);
      background-color: rgba(0, 123, 255, 0.05);
    }

    @keyframes pulse {
      0% { border-color: var(--dark-msg-me); }
      50% { border-color: #66b3ff; }
      100% { border-color: var(--dark-msg-me); }
    }

    .light-mode @keyframes pulse {
      0% { border-color: var(--light-msg-me); }
      50% { border-color: #66b3ff; }
      100% { border-color: var(--light-msg-me); }
    }

    /* Fullscreen Image Modal */
    .image-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.9);
      z-index: 10001;
      align-items: center;
      justify-content: center;
      padding: 20px;
      cursor: pointer;
    }

    .image-modal.active {
      display: flex;
    }

    .modal-content {
      max-width: 90%;
      max-height: 90%;
      position: relative;
      cursor: default;
    }

    .modal-content img {
      max-width: 100%;
      max-height: 90vh;
      object-fit: contain;
      border-radius: 8px;
      cursor: default;
    }

    .modal-close {
      position: absolute;
      top: -40px;
      right: 0;
      color: white;
      font-size: 30px;
      font-weight: bold;
      cursor: pointer;
      background: none;
      border: none;
      padding: 5px 10px;
      z-index: 10002;
    }

    .modal-close:hover {
      color: #ddd;
    }

    /* Scrollbar styling */
    .posts-container::-webkit-scrollbar {
      width: 8px;
    }

    .posts-container::-webkit-scrollbar-track {
      background: var(--dark-chat-bg);
    }

    .posts-container::-webkit-scrollbar-thumb {
      background: var(--dark-input-bg);
      border-radius: 4px;
    }

    .posts-container::-webkit-scrollbar-thumb:hover {
      background: var(--dark-input-focus);
    }

    .light-mode .posts-container::-webkit-scrollbar-track {
      background: var(--light-chat-bg);
    }

    .light-mode .posts-container::-webkit-scrollbar-thumb {
      background: var(--light-input-bg);
    }

    .light-mode .posts-container::-webkit-scrollbar-thumb:hover {
      background: var(--light-input-focus);
    }

/* SEARCH BAR STYLING */
.search-container {
  width: 100%;
  max-width: 600px;
  margin: 10px auto;
  display: flex;
  justify-content: center;
}

.search-box {
  position: relative;
  width: 100%;
}

#searchInput {
  width: 100%;
  padding: 10px 40px 10px 15px;
  border: none;
  border-radius: 20px;
  font-size: 0.95em;
  outline: none;
  background: var(--dark-input-bg);
  color: var(--dark-text);
  transition: background 0.3s, color 0.3s;
  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

#searchInput:focus {
  background: var(--dark-input-focus);
}

.light-mode #searchInput {
  background: var(--light-input-bg);
  color: var(--light-text);
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.light-mode #searchInput:focus {
  background: var(--light-input-focus);
}

/* CLEAR BUTTON */
.clear-search-btn {
  position: absolute;
  right: 10px;
  top: 50%;
  transform: translateY(-50%);
  background: none;
  border: none;
  color: var(--dark-icon-color);
  font-size: 1em;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 28px;
  height: 28px;
  border-radius: 50%;
  transition: background 0.2s, color 0.2s;
}

.clear-search-btn:hover {
  background: var(--dark-icon-hover-bg);
}

.light-mode .clear-search-btn {
  color: var(--light-icon-color);
}

.light-mode .clear-search-btn:hover {
  background: var(--light-icon-hover-bg);
}

.load-more-container {
    display: flex;
    justify-content: center;
    margin: 20px 0;
    padding: 15px 0;
}

.load-more-btn {
    background-color: var(--post-btn);
    color: white;
    border: none;
    border-radius: 8px;
    padding: 12px 24px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
}

.load-more-btn:hover {
    background-color: var(--post-btn-hover);
    transform: translateY(-2px);
}

.load-more-btn:active {
    transform: translateY(0);
}
    
    /* Responsive adjustments */
    @media (max-width: 600px) {
      .post-input-container {
        margin: 15px 10px;
        padding: 5px;
      }
      
      .post {
        margin: 10px 10px;
        padding: 12px;
      }
      
      .buttons button {
        padding: 5px 10px;
        font-size: 0.8em;
      }
      
      .share-btn span {
        display: none;
      }
      
      .share-btn {
        padding: 8px;
      }

      .header-right {
        gap: 5px;
      }

    .search-container {
    padding: 0 10px;
  }

  #searchInput {
    font-size: 0.9em;
    padding: 8px 35px 8px 12px;
  }

  .clear-search-btn {
    width: 24px;
    height: 24px;
    font-size: 0.9em;
  }
    }
  </style>

<div class="app-header">
  <div class="header-left">
    <button class="menu-btn" onclick="toggleMenu()">&#9776;</button>
    <img src="/chat/logo.png" alt="TalkRush Logo" class="logo">
    <h1 class="app-title">Anonymous Posts</h1>
  </div>
  <div class="header-right">
    <button class="theme-toggle" id="themeToggle" title="Toggle Dark/Light Mode">
      <i class="fas fa-moon"></i>
    </button>
    <button id="shareBtn" class="share-btn">
      <i class="fa-solid fa-arrow-up-from-bracket"></i>
      <span>Share</span>
    </button>
  </div>
</div>

<div class="posts-container" id="postsContainer">
  <!-- Post input at top -->
  <div class="post-input-container">
    <div class="post-input-wrapper">
      <textarea 
        id="postText" 
        class="post-textarea" 
        placeholder="Write here..."
        rows="3"
      ></textarea>
      <button class="post-button" onclick="submitPost()">
        <i class="fas fa-paper-plane"></i> Post
      </button>
    </div>
  </div>

<div class="search-container">
  <div class="search-box">
    <input type="text" id="searchInput" placeholder="Search posts by nickname or content...">
    <button id="clearSearch" class="clear-search-btn" title="Clear search">
      <i class="fas fa-times"></i>
    </button>
  </div>
</div>
    
  <!-- Error container below post input -->
  <div class="error-container" id="errorContainer"></div>
  
  <!-- Posts will be loaded here -->
</div>

<!-- Fullscreen Image Modal -->
<div class="image-modal" id="imageModal">
  <button class="modal-close" id="modalClose">&times;</button>
  <div class="modal-content">
    <img id="modalImage" src="" alt="Fullscreen image">
  </div>
</div>

{% include menu.html %}
{% include scripts.html %}

<script>
    const firebaseConfig = {
      databaseURL: "https://talkrush-76259-default-rtdb.asia-southeast1.firebasedatabase.app/"
    };
    
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const POST_EXPIRY_DAYS = 30;
    const MILLISECONDS_IN_DAY = 24 * 60 * 60 * 1000;
    const POSTS_PER_PAGE = 5;

    let bannedWords = [];
    let bannedWordsLoaded = false;
    let allPosts = [];
    let displayedPosts = [];
    let currentPage = 0;
    let currentSearchTerm = '';
    let highlightPostId = null;
    let keyboardTimeout;

    // Cache DOM elements for better performance
    const domCache = {
      postsContainer: null,
      postInputContainer: null,
      searchContainer: null,
      errorContainer: null,
      searchInput: null,
      clearSearchBtn: null,
      postText: null,
      modal: null,
      modalClose: null
    };

    function cacheDOM() {
      domCache.postsContainer = document.getElementById("postsContainer");
      domCache.postInputContainer = document.querySelector('.post-input-container');
      domCache.searchContainer = document.querySelector('.search-container');
      domCache.errorContainer = document.getElementById("errorContainer");
      domCache.searchInput = document.getElementById('searchInput');
      domCache.clearSearchBtn = document.getElementById('clearSearch');
      domCache.postText = document.getElementById('postText');
      domCache.modal = document.getElementById('imageModal');
      domCache.modalClose = document.getElementById('modalClose');
    }

    async function loadBannedWords() {
      try {
        const response = await fetch('/chat/filter.txt');
        const text = await response.text();
        bannedWords = text.split('\n')
          .map(word => word.trim().toLowerCase())
          .filter(word => word.length > 0);
        bannedWordsLoaded = true;
      } catch (err) {
        bannedWords = ['badword1', 'badword2', 'swearword'];
        bannedWordsLoaded = true;
      }
    }

    function containsBannedWords(message) {
      if (!bannedWordsLoaded || !message || typeof message !== 'string') return false;
      
      const lowerMsg = message.toLowerCase();
      return bannedWords.some(word => {
        if (!word || word.length < 2) return false;
        const escapedWord = word.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        const pattern = new RegExp(`\\b${escapedWord}\\b`, 'i');
        return pattern.test(message);
      });
    }

    function getNickname() {
      const savedNickname = localStorage.getItem("talkrush_nickname");
      if (savedNickname) {
        return savedNickname;
      }
      return null;
    }

    function getUserId() {
      let userId = localStorage.getItem("talkrush_user_id");
      if (!userId) {
        userId = 'user_' + Math.random().toString(36).substr(2, 9);
        localStorage.setItem("talkrush_user_id", userId);
      }
      return userId;
    }

    function showError(message) {
      const errorContainer = domCache.errorContainer;
      const errorDiv = document.createElement("div");
      errorDiv.className = "error-message";
      errorDiv.innerHTML = `<i class="fas fa-exclamation-circle"></i> ${message}`;
      errorContainer.appendChild(errorDiv);
      
      setTimeout(() => {
        if (errorDiv.parentNode) {
          errorDiv.remove();
        }
      }, 5000);
    }

    function showSuccess(message) {
      const errorContainer = domCache.errorContainer;
      const successDiv = document.createElement("div");
      successDiv.className = "success-message";
      successDiv.innerHTML = `<i class="fas fa-check-circle"></i> ${message}`;
      errorContainer.appendChild(successDiv);
      
      setTimeout(() => {
        if (successDiv.parentNode) {
          successDiv.remove();
        }
      }, 3000);
    }

    function extractURL(text) {
      const urlRegex = /(https?:\/\/[^\s]+)|(www\.[^\s]+)|([a-zA-Z0-9-]+\.[a-zA-Z]{2,}(\/[^\s]*)?)/g;
      const matches = text.match(urlRegex);
      return matches ? matches[0] : null;
    }

    function isImageURL(url) {
      if (!url) return false;
      const imageExtensions = ['.png', '.jpg', '.jpeg', '.gif', '.webp', '.bmp', '.svg'];
      const lowerUrl = url.toLowerCase();
      return imageExtensions.some(ext => lowerUrl.includes(ext));
    }

    function normalizeURL(url) {
      if (!url) return null;
      if (!url.startsWith('http://') && !url.startsWith('https://')) {
        return 'https://' + url;
      }
      return url;
    }

    function makeTextClickable(text) {
      if (!text) return '';
      const urlRegex = /(https?:\/\/[^\s]+)|(www\.[^\s]+)|([a-zA-Z0-9-]+\.[a-zA-Z]{2,}(\/[^\s]*)?)/g;
      
      return text.replace(urlRegex, (url) => {
        const href = normalizeURL(url);
        return `<a href="${href}" target="_blank" rel="noopener nofollow">${url}</a>`;
      });
    }

    function searchPosts(searchTerm) {
      currentSearchTerm = searchTerm.toLowerCase().trim();
      currentPage = 0;
      
      if (!currentSearchTerm) {
        displayedPosts = [...allPosts];
        displayPostsPage();
        return;
      }
      
      displayedPosts = allPosts.filter(([postId, post]) => {
        const nickname = post.nickname || '';
        const text = post.text || '';
        
        return nickname.toLowerCase().includes(currentSearchTerm) || 
               text.toLowerCase().includes(currentSearchTerm);
      });
      
      displayPostsPage();
    }

    function clearSearch() {
      if (domCache.searchInput) {
        domCache.searchInput.value = '';
      }
      currentSearchTerm = '';
      displayedPosts = [...allPosts];
      currentPage = 0;
      displayPostsPage();
    }

    function createAdElement() {
      const adContainer = document.createElement('div');
      adContainer.className = 'ad-container';
      
      adContainer.innerHTML = `
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-7059052735946479"
             data-ad-slot="8592327962"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
      `;
      
      return adContainer;
    }

    async function submitPost() {
      const nickname = getNickname();
      if (!nickname) {
        showError("Please set your Nickname first in the Home Page!");
        return;
      }

      const text = domCache.postText ? domCache.postText.value.trim() : '';
      if (text === "") {
        showError("Write something!");
        return;
      }

      if (containsBannedWords(text)) {
        showError("Your post contains inappropriate content and cannot be sent.");
        return;
      }

      if (containsBannedWords(nickname)) {
        showError("Your Nickname contains Inappropriate Words. Please change it.");
        return;
      }

      const userId = getUserId();
      const url = extractURL(text);
      
      const newPostRef = db.ref("posts").push();
      const postId = newPostRef.key;
      
      const postData = {
        nickname: nickname,
        text: text,
        timestamp: Date.now(),
        likes: 0,
        dislikes: 0,
        userId: userId,
        postId: postId
      };

      try {
        await newPostRef.set(postData);
        if (domCache.postText) {
          domCache.postText.value = "";
        }
        showSuccess("Post published successfully!");
        
        if (currentSearchTerm) {
          clearSearch();
        }
      } catch (error) {
        showError("Failed to publish post. Please try again.");
      }
    }

    function deletePost(postId, userId) {
      const currentUserId = getUserId();
      if (userId !== currentUserId) {
        showError("You can only delete your own posts!");
        return;
      }

      Swal.fire({
        title: 'Are you sure?',
        text: "This action cannot be undone!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#dc3545',
        cancelButtonColor: '#6c757d',
        confirmButtonText: 'Yes, delete it!',
        cancelButtonText: 'Cancel',
        background: document.body.classList.contains('light-mode') ? '#fff' : '#1e1e1e',
        color: document.body.classList.contains('light-mode') ? '#333' : '#fff'
      }).then((result) => {
        if (result.isConfirmed) {
          db.ref("posts/" + postId).remove()
            .then(() => {
              Swal.fire({
                title: 'Deleted!',
                text: 'Your post has been deleted.',
                icon: 'success',
                confirmButtonColor: '#007bff',
                background: document.body.classList.contains('light-mode') ? '#fff' : '#1e1e1e',
                color: document.body.classList.contains('light-mode') ? '#333' : '#fff'
              });
            })
            .catch(error => {
              Swal.fire({
                title: 'Error!',
                text: 'Failed to delete post.',
                icon: 'error',
                confirmButtonColor: '#dc3545',
                background: document.body.classList.contains('light-mode') ? '#fff' : '#1e1e1e',
                color: document.body.classList.contains('light-mode') ? '#333' : '#fff'
              });
            });
        }
      });
    }

    async function sharePost(post) {
      const shareUrl = window.location.origin + window.location.pathname + '?postId=' + post.postId;

      const shareData = {
        title: 'Check out this post',
        text: post.text.substring(0, 100) + '...',
        url: shareUrl
      };

      try {
        if (navigator.share) {
          await navigator.share(shareData);
        } else {
          await navigator.clipboard.writeText(shareUrl);
          showSuccess("Link copied to clipboard!");
        }
      } catch (error) {
        await navigator.clipboard.writeText(shareUrl);
        showSuccess("Link copied to clipboard!");
      }
    }

    function checkSharedPost() {
      const urlParams = new URLSearchParams(window.location.search);
      const sharedPostId = urlParams.get('postId');
      
      if (sharedPostId) {
        highlightPostId = sharedPostId;
        
        const newUrl = window.location.protocol + "//" + window.location.host + window.location.pathname;
        window.history.replaceState({}, document.title, newUrl);
        
        showSuccess("You've opened a shared post. It will be highlighted.");
      }
    }

    function highlightPost(postId) {
      const postElement = document.querySelector(`[data-post-id="${postId}"]`);
      if (postElement) {
        postElement.classList.add('highlighted-post');
        postElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
        
        setTimeout(() => {
          postElement.classList.remove('highlighted-post');
        }, 5000);
      }
    }

    function hasUserInteracted(postId, type) {
      const interactions = JSON.parse(localStorage.getItem('postInteractions') || '{}');
      return interactions[postId] === type;
    }

    function setUserInteraction(postId, type) {
      const interactions = JSON.parse(localStorage.getItem('postInteractions') || '{}');
      interactions[postId] = type;
      localStorage.setItem('postInteractions', JSON.stringify(interactions));
    }

    function removeUserInteraction(postId) {
      const interactions = JSON.parse(localStorage.getItem('postInteractions') || '{}');
      delete interactions[postId];
      localStorage.setItem('postInteractions', JSON.stringify(interactions));
    }

    function likePost(postId) {
      const nickname = getNickname();
      if (!nickname) {
        showError("Please set your Nickname first in the Home Page!");
        return;
      }

      const currentInteraction = hasUserInteracted(postId, 'like') ? 'like' : 
                                hasUserInteracted(postId, 'dislike') ? 'dislike' : null;

      if (currentInteraction === 'like') {
        const likeRef = db.ref("posts/" + postId + "/likes");
        likeRef.transaction(current => Math.max(0, (current || 0) - 1));
        removeUserInteraction(postId);
      } else {
        if (currentInteraction === 'dislike') {
          const dislikeRef = db.ref("posts/" + postId + "/dislikes");
          dislikeRef.transaction(current => Math.max(0, (current || 0) - 1));
        }

        const likeRef = db.ref("posts/" + postId + "/likes");
        likeRef.transaction(current => (current || 0) + 1);
        setUserInteraction(postId, 'like');
      }
    }

    function dislikePost(postId) {
      const nickname = getNickname();
      if (!nickname) {
        showError("Please set your Nickname first in the Home Page!");
        return;
      }

      const currentInteraction = hasUserInteracted(postId, 'like') ? 'like' : 
                                hasUserInteracted(postId, 'dislike') ? 'dislike' : null;

      if (currentInteraction === 'dislike') {
        const dislikeRef = db.ref("posts/" + postId + "/dislikes");
        dislikeRef.transaction(current => Math.max(0, (current || 0) - 1));
        removeUserInteraction(postId);
      } else {
        if (currentInteraction === 'like') {
          const likeRef = db.ref("posts/" + postId + "/likes");
          likeRef.transaction(current => Math.max(0, (current || 0) - 1));
        }

        const dislikeRef = db.ref("posts/" + postId + "/dislikes");
        dislikeRef.transaction(current => (current || 0) + 1);
        setUserInteraction(postId, 'dislike');
      }
    }

    function openImageModal(imageUrl) {
      const modal = domCache.modal;
      const modalImage = document.getElementById('modalImage');
      
      if (modalImage) {
        modalImage.src = imageUrl;
      }
      if (modal) {
        modal.classList.add('active');
        document.body.style.overflow = 'hidden';
      }
    }

    function closeImageModal() {
      const modal = domCache.modal;
      if (modal) {
        modal.classList.remove('active');
        document.body.style.overflow = '';
      }
    }

    function updatePostCounts(postId, likes, dislikes) {
      const postElement = document.querySelector(`[data-post-id="${postId}"]`);
      if (postElement) {
        const likeCountElement = postElement.querySelector('.like-count');
        const dislikeCountElement = postElement.querySelector('.dislike-count');
        const likeBtn = postElement.querySelector('.like-btn');
        const dislikeBtn = postElement.querySelector('.dislike-btn');
        
        if (likeCountElement) likeCountElement.textContent = likes || 0;
        if (dislikeCountElement) dislikeCountElement.textContent = dislikes || 0;
        
        const userInteraction = hasUserInteracted(postId, 'like') ? 'like' : 
                               hasUserInteracted(postId, 'dislike') ? 'dislike' : null;
        
        if (likeBtn) {
          likeBtn.classList.toggle('active', userInteraction === 'like');
        }
        if (dislikeBtn) {
          dislikeBtn.classList.toggle('active', userInteraction === 'dislike');
        }
      }
    }

    function isPostExpired(timestamp) {
      const postAgeInDays = (Date.now() - timestamp) / MILLISECONDS_IN_DAY;
      return postAgeInDays > POST_EXPIRY_DAYS;
    }

    function deleteExpiredPosts() {
      const currentTime = Date.now();
      const expiryThreshold = currentTime - (POST_EXPIRY_DAYS * MILLISECONDS_IN_DAY);
      
      db.ref("posts").orderByChild("timestamp").endAt(expiryThreshold).once("value")
        .then(snapshot => {
          const deletions = [];
          snapshot.forEach(childSnapshot => {
            deletions.push(childSnapshot.ref.remove());
          });
          return Promise.all(deletions);
        })
        .then(() => {
          if (deletions.length > 0) {
            console.log(`Deleted ${deletions.length} expired posts`);
          }
        })
        .catch(error => {
          console.error("Error deleting expired posts:", error);
        });
    }

    function extractFirstImageURL(text) {
      if (!text) return null;
      
      const urlRegex = /(https?:\/\/[^\s]+)|(www\.[^\s]+)|([a-zA-Z0-9-]+\.[a-zA-Z]{2,}(\/[^\s]*)?)/g;
      const urls = text.match(urlRegex) || [];
      
      const imageURL = urls.find(url => isImageURL(url));
      return imageURL ? normalizeURL(imageURL) : null;
    }

    function createPostElement(postId, post) {
      const currentUserId = getUserId();
      const isMyPost = post.userId === currentUserId;
      
      const displayText = containsBannedWords(post.text) 
        ? "This post was hidden due to inappropriate content"
        : makeTextClickable(post.text);

      const displayNickname = containsBannedWords(post.nickname)
        ? "Anonymous"
        : (post.nickname || 'Anonymous');

      // Extract only the first image URL from post text
      const imageURL = extractFirstImageURL(post.text);
      let imagePreviewHTML = '';
      
      if (imageURL && !containsBannedWords(post.text)) {
        imagePreviewHTML = `
          <div class="image-preview">
            <img src="${imageURL}" alt="Image preview" 
                 onclick="openImageModal('${imageURL}')"
                 onerror="this.style.display='none'"
                 loading="lazy"
                 style="cursor: pointer;">
          </div>
        `;
      }

      const userInteraction = hasUserInteracted(postId, 'like') ? 'like' : 
                             hasUserInteracted(postId, 'dislike') ? 'dislike' : null;

      const postElement = document.createElement("div");
      postElement.className = "post";
      postElement.setAttribute("data-post-id", postId);
      
      postElement.innerHTML = `
        <div class="nickname">${displayNickname}</div>
        <div class="post-content">${displayText}</div>
        ${imagePreviewHTML}
        <div class="timestamp">${timeSince(post.timestamp)}</div>
        <div class="buttons">
          <button class="like-btn ${userInteraction === 'like' ? 'active' : ''}" onclick="likePost('${postId}')">
            <i class="fas fa-thumbs-up"></i> <span class="like-count">${post.likes || 0}</span>
          </button>
          <button class="dislike-btn ${userInteraction === 'dislike' ? 'active' : ''}" onclick="dislikePost('${postId}')">
            <i class="fas fa-thumbs-down"></i> <span class="dislike-count">${post.dislikes || 0}</span>
          </button>
          <button class="share-btn-post" onclick="sharePost(${JSON.stringify({...post, postId}).replace(/"/g, '&quot;')})">
            <i class="fas fa-share"></i> Share
          </button>
          ${isMyPost ? `
            <button class="delete-btn" onclick="deletePost('${postId}', '${post.userId}')">
              <i class="fas fa-trash"></i> Delete
            </button>
          ` : ''}
        </div>
      `;
      
      return postElement;
    }

    function displayPostsPage() {
      const postsContainer = domCache.postsContainer;
      if (!postsContainer) return;
      
      // Calculate which posts to show
      const startIndex = 0;
      const endIndex = (currentPage + 1) * POSTS_PER_PAGE;
      const postsToShow = displayedPosts.slice(startIndex, endIndex);
      
      // Clear existing posts but keep input, search, and error containers
      const existingPosts = postsContainer.querySelectorAll('.post, .system-msg, .ad-container, .load-more-container');
      existingPosts.forEach(el => el.remove());
      
      // Re-add input, search, and error containers
      if (domCache.postInputContainer) {
        postsContainer.appendChild(domCache.postInputContainer);
      }
      if (domCache.searchContainer) {
        postsContainer.appendChild(domCache.searchContainer);
      }
      if (domCache.errorContainer) {
        postsContainer.appendChild(domCache.errorContainer);
      }
      
      if (!postsToShow || postsToShow.length === 0) {
        const noPostsMsg = document.createElement("div");
        noPostsMsg.className = "system-msg";
        noPostsMsg.textContent = currentSearchTerm ? 
          "No posts found matching your search." : 
          "No posts yet. Be the first to post!";
        postsContainer.appendChild(noPostsMsg);
        return;
      }

      let adCounter = 0;

      postsToShow.forEach(([postId, post], index) => {
        if (isPostExpired(post.timestamp)) {
          return;
        }

        const postElement = createPostElement(postId, post);
        postsContainer.appendChild(postElement);
        
        adCounter++;
        if (adCounter % 2 === 0) {
          const adElement = createAdElement();
          postsContainer.appendChild(adElement);
          
          try {
            (adsbygoogle = window.adsbygoogle || []).push({});
          } catch (error) {}
        }
        
        if (postId === highlightPostId) {
          setTimeout(() => {
            highlightPost(postId);
          }, 100);
        }
      });
      
      // Add Load More button if there are more posts to show
      if (endIndex < displayedPosts.length) {
        const loadMoreContainer = document.createElement('div');
        loadMoreContainer.className = 'load-more-container';
        loadMoreContainer.innerHTML = `
          <button id="loadMoreBtn" class="load-more-btn">
            <i class="fas fa-chevron-down"></i> Load More Posts
          </button>
        `;
        postsContainer.appendChild(loadMoreContainer);
        
        // Add event listener to the new button
        const loadMoreBtn = document.getElementById('loadMoreBtn');
        if (loadMoreBtn) {
          loadMoreBtn.addEventListener('click', loadMorePosts);
        }
      }
    }

    function loadMorePosts() {
      currentPage++;
      displayPostsPage();
    }

    function timeSince(ts) {
      const seconds = Math.floor((Date.now() - ts) / 1000);
      const intervals = [
        [31536000, 'year'],
        [2592000, 'month'],
        [86400, 'day'],
        [3600, 'hour'],
        [60, 'minute'],
        [1, 'second']
      ];
      for (const [unit, label] of intervals) {
        const count = Math.floor(seconds / unit);
        if (count >= 1) return `${count} ${label}${count > 1 ? 's' : ''} ago`;
      }
      return "just now";
    }

    function initializeEventListeners() {
      if (domCache.searchInput) {
        domCache.searchInput.addEventListener('input', (e) => {
          searchPosts(e.target.value);
        });
      }
      
      if (domCache.clearSearchBtn) {
        domCache.clearSearchBtn.addEventListener('click', clearSearch);
      }

      if (domCache.modalClose) {
        domCache.modalClose.addEventListener('click', closeImageModal);
      }
      
      if (domCache.modal) {
        domCache.modal.addEventListener('click', (e) => {
          if (e.target === domCache.modal || e.target.classList.contains('modal-close')) {
            closeImageModal();
          }
        });
      }
      
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && domCache.modal && domCache.modal.classList.contains('active')) {
          closeImageModal();
        }
      });

      if (domCache.postText) {
        domCache.postText.addEventListener('input', function() {
          clearTimeout(keyboardTimeout);
          keyboardTimeout = setTimeout(() => {
            if (document.activeElement === domCache.postText) {
              domCache.postText.focus();
            }
          }, 3000);
        });

        domCache.postText.addEventListener('blur', function() {
          clearTimeout(keyboardTimeout);
        });
      }
    }

    function initializeApp() {
      cacheDOM();
      loadBannedWords();
      checkSharedPost();
      deleteExpiredPosts();
      initializeEventListeners();
      
      setInterval(deleteExpiredPosts, 60 * 60 * 1000);

      const nickname = getNickname();
      if (nickname) {
        showSuccess(`Welcome back, ${nickname}!`);
      } else {
        showError("Please set your Nickname in the Home Page to Start Posting!");
      }

      db.ref("posts").on("value", snapshot => {
        const posts = snapshot.val();
        
        if (!posts) {
          allPosts = [];
          displayedPosts = [];
          displayPostsPage();
          return;
        }

        let postsArray = Object.entries(posts);
        
        if (allPosts.length === 0) {
          for (let i = postsArray.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [postsArray[i], postsArray[j]] = [postsArray[j], postsArray[i]];
          }
        } else {
          const existingIds = new Set(allPosts.map(([id]) => id));
          const newPosts = postsArray.filter(([id]) => !existingIds.has(id));
          const existingPosts = postsArray.filter(([id]) => existingIds.has(id));
          
          const orderedExisting = allPosts.filter(([id]) => existingIds.has(id));
          postsArray = [...orderedExisting, ...newPosts];
        }

        allPosts = postsArray;
        displayedPosts = [...allPosts];

        if (highlightPostId && posts[highlightPostId]) {
          const highlightedPostIndex = displayedPosts.findIndex(([id]) => id === highlightPostId);
          if (highlightedPostIndex !== -1) {
            const highlightedPost = displayedPosts.splice(highlightedPostIndex, 1)[0];
            displayedPosts.unshift(highlightedPost);
          }
        }

        if (currentSearchTerm) {
          searchPosts(currentSearchTerm);
        } else {
          currentPage = 0;
          displayPostsPage();
        }
      });

      // Only update individual posts when they change, don't re-render everything
      db.ref("posts").on("child_changed", snapshot => {
        const post = snapshot.val();
        const postId = snapshot.key;
        
        updatePostCounts(postId, post.likes, post.dislikes);
        
        const postIndex = allPosts.findIndex(([id]) => id === postId);
        if (postIndex !== -1) {
          allPosts[postIndex][1] = post;
        }
        
        const displayedIndex = displayedPosts.findIndex(([id]) => id === postId);
        if (displayedIndex !== -1) {
          displayedPosts[displayedIndex][1] = post;
        }
      });

      db.ref("posts").on("child_removed", snapshot => {
        const postId = snapshot.key;
        
        allPosts = allPosts.filter(([id]) => id !== postId);
        displayedPosts = displayedPosts.filter(([id]) => id !== postId);
        
        removeUserInteraction(postId);
        
        if (currentSearchTerm) {
          searchPosts(currentSearchTerm);
        } else {
          displayPostsPage();
        }
      });
    }

    initializeApp();
</script>
