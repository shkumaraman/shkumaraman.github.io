---
layout: default
title: "Watch Party"
description: "Watch videos together in sync with friends. Real-time playback synchronization, group chat, supports YouTube & direct video links. Perfect for movie nights!"
---
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
background:#0f172a;
font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
display:flex;
justify-content:center;
align-items:center;
min-height:100vh;
}
.frame{
max-width:700px;
width:100%;
padding:15px;
}
.link-bar{
display:flex;
gap:12px;
margin-bottom:20px;
flex-wrap:wrap;
}
.link-field{
flex:1;
display:flex;
align-items:center;
background:#1e293b;
border:1px solid #334155;
border-radius:60px;
padding:0 18px;
}
#videoLink{
width:100%;
padding:14px 0;
border:none;
background:transparent;
font-size:1rem;
outline:none;
color:white;
}
#videoLink::placeholder{color:#64748b}
.load-btn{
background:#3b82f6;
color:white;
border:none;
border-radius:60px;
padding:0 28px;
font-weight:600;
font-size:1rem;
cursor:pointer;
transition:0.2s;
}
.load-btn:hover{background:#2563eb}
.player-box{
background:#000000;
border-radius:24px;
overflow:hidden;
margin-bottom:18px;
border:1px solid #334155;
}
#player{
width:100%;
aspect-ratio:16/9;
border:none;
background:#000;
}
.video-controls{
background:#0f172a;
padding:15px 20px;
display:flex;
align-items:center;
gap:15px;
flex-wrap:wrap;
border-top:1px solid #334155;
}
.control-btn{
background:#1e293b;
border:none;
color:#94a3b8;
width:45px;
height:45px;
border-radius:50%;
cursor:pointer;
display:flex;
align-items:center;
justify-content:center;
font-size:1.2rem;
transition:all 0.2s;
}
.control-btn:hover{
background:#3b82f6;
color:white;
transform:scale(1.05);
}
.progress-area{
flex:1;
display:flex;
align-items:center;
gap:15px;
min-width:250px;
}
.progress-bar{
flex:1;
height:6px;
background:#1e293b;
border-radius:3px;
cursor:pointer;
position:relative;
}
.progress-fill{
height:100%;
background:#3b82f6;
border-radius:3px;
width:0%;
position:relative;
}
.progress-fill::after{
content:'';
position:absolute;
right:-6px;
top:-4px;
width:14px;
height:14px;
background:#3b82f6;
border-radius:50%;
opacity:0;
transition:opacity 0.2s;
}
.progress-bar:hover .progress-fill::after{
opacity:1;
}
.time-display{
color:#94a3b8;
font-size:0.95rem;
font-family:monospace;
min-width:110px;
}
.chat-area{
background:#1e293b;
border-radius:24px;
border:1px solid #334155;
overflow:hidden;
margin-top:16px;
}
.msg-window{
background:#0f172a;
padding:16px;
height:220px;
overflow-y:auto;
display:flex;
flex-direction:column;
gap:8px;
}
.msg-text{
color:white;
font-size:0.95rem;
line-height:1.4;
}
.chat-input-row{
display:flex;
padding:12px;
background:#1e293b;
gap:8px;
}
.chat-field{
flex:1;
}
#chatMessage{
width:100%;
padding:12px 16px;
border-radius:25px;
border:1px solid #334155;
background:#0f172a;
color:white;
outline:none;
}
#chatMessage::placeholder{color:#64748b}
.send-btn{
background:#3b82f6;
border:none;
color:white;
border-radius:50%;
width:44px;
height:44px;
cursor:pointer;
transition:0.2s;
}
.send-btn:hover{background:#2563eb;transform:scale(1.05)}
</style>

<div class="frame">
<div class="link-bar">
<div class="link-field">
<input id="videoLink" placeholder="Paste YouTube link or video URL" autofocus>
</div>
<button class="load-btn" id="loadBtn">
<i class="fas fa-play"></i> Load
</button>
</div>

<div class="player-box">
<iframe id="player" allow="autoplay; fullscreen" allowfullscreen></iframe>
<div class="video-controls">
<button class="control-btn" id="prevBtn" title="Back 10 seconds">
<i class="fas fa-backward"></i>
</button>
<button class="control-btn" id="playPauseBtn" title="Play/Pause">
<i class="fas fa-play" id="playPauseIcon"></i>
</button>
<button class="control-btn" id="nextBtn" title="Forward 10 seconds">
<i class="fas fa-forward"></i>
</button>
<div class="progress-area">
<div class="progress-bar" id="progressBar">
<div class="progress-fill" id="progressFill"></div>
</div>
<span class="time-display" id="timeDisplay">0:00 / 0:00</span>
</div>
</div>
</div>

<div class="chat-area">
<div id="chatMessages" class="msg-window"></div>
<div class="chat-input-row">
<div class="chat-field">
<input id="chatMessage" placeholder="Type a message...">
</div>
<button id="sendChatBtn" class="send-btn">
<i class="fas fa-paper-plane"></i>
</button>
</div>
</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getDatabase, ref, onValue, update, push, set } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

const firebaseConfig = {
databaseURL: "https://talkrush-76259-default-rtdb.asia-southeast1.firebasedatabase.app/"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const watchRef = ref(db, "watch");
const chatRef = ref(db, "watch/messages");

const player = document.getElementById("player");
const input = document.getElementById("videoLink");
const loadBtn = document.getElementById("loadBtn");
const chatBox = document.getElementById("chatMessages");
const chatInput = document.getElementById("chatMessage");
const sendBtn = document.getElementById("sendChatBtn");
const playPauseBtn = document.getElementById("playPauseBtn");
const playPauseIcon = document.getElementById("playPauseIcon");
const prevBtn = document.getElementById("prevBtn");
const nextBtn = document.getElementById("nextBtn");
const progressFill = document.getElementById("progressFill");
const progressBar = document.getElementById("progressBar");
const timeDisplay = document.getElementById("timeDisplay");

let currentLink = "";
let isYouTube = false;
let playerReady = false;
let localUpdate = false;
let hasUserLeft = false;
let currentVideoTime = 0;
let videoDuration = 0;
let isPlaying = false;
let youtubeInterval = null;
let updateInterval = null;
let lastAutoUpdate = 0;
let isBackgroundPaused = false;
let firstLoad = true;

function extractYouTubeId(url) {
const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
const match = url.match(regExp);
return (match && match[2].length === 11) ? match[2] : null;
}

function isVideoFile(url) {
try {
const parsed = new URL(url);
const path = parsed.pathname.toLowerCase();
return path.match(/\.(mp4|webm|ogg|avi|mkv|mov|flv|wmv)$/i) !== null;
} catch {
return false;
}
}

function formatTime(seconds) {
if (!seconds || isNaN(seconds)) return "0:00";
const mins = Math.floor(seconds / 60);
const secs = Math.floor(seconds % 60);
return `${mins}:${secs.toString().padStart(2,'0')}`;
}

function loadVideo(link, startTime = 0) {
const ytId = extractYouTubeId(link);
isYouTube = !!ytId;
currentLink = link;
playerReady = true;

if (youtubeInterval) {
clearInterval(youtubeInterval);
youtubeInterval = null;
}

if (updateInterval) {
clearInterval(updateInterval);
updateInterval = null;
}

if (ytId) {
player.src = `https://www.youtube.com/embed/${ytId}?enablejsapi=1&origin=${window.location.origin}&start=${Math.floor(startTime)}`;
setupYouTubeAPI();
} else if (isVideoFile(link)) {
player.src = link;
setupHTML5Video(startTime);
} else {
alert("Link not supported. Use YouTube or direct video");
playerReady = false;
return;
}

set(watchRef, {
link: link,
playing: true,
timestamp: startTime,
lastUpdate: Date.now()
});

startProgressUpdate();
}

function startProgressUpdate() {
if (updateInterval) clearInterval(updateInterval);
updateInterval = setInterval(() => {
if (playerReady && currentLink) {
updateProgressAndTime();
}
}, 100);
}

function setupYouTubeAPI() {
youtubeInterval = setInterval(() => {
if (!isYouTube || !player || !player.contentWindow) return;
const message = JSON.stringify({event: 'listening', id: 1});
player.contentWindow.postMessage(message, '*');
}, 1000);

window.addEventListener('message', function onYouTubeMessage(event) {
if (!isYouTube || !event.data || typeof event.data !== 'string') return;

try {
const data = JSON.parse(event.data);
if (data.event === 'infoDelivery' && data.info) {
if (data.info.currentTime !== undefined) {
currentVideoTime = data.info.currentTime;
}
if (data.info.duration !== undefined) {
videoDuration = data.info.duration || 0;
}
if (data.info.playerState !== undefined) {
const wasPlaying = isPlaying;
isPlaying = (data.info.playerState === 1);
if (wasPlaying !== isPlaying) {
updatePlayPauseIcon();
}
}
}
} catch (e) {}
});
}

function setupHTML5Video(startTime) {
const checkVideo = () => {
const video = player.contentDocument?.querySelector('video');
if (video) {
video.currentTime = startTime;
video.play();

video.addEventListener('play', () => {
isPlaying = true;
updatePlayPauseIcon();
if (!localUpdate && !hasUserLeft) {
update(watchRef, {
playing: true,
timestamp: video.currentTime,
lastUpdate: Date.now()
});
}
});

video.addEventListener('pause', () => {
isPlaying = false;
updatePlayPauseIcon();
if (!localUpdate && !hasUserLeft) {
update(watchRef, {
playing: false,
timestamp: video.currentTime,
lastUpdate: Date.now()
});
}
});

video.addEventListener('timeupdate', () => {
if (video.duration) {
currentVideoTime = video.currentTime;
videoDuration = video.duration;
}
});

video.addEventListener('loadedmetadata', () => {
videoDuration = video.duration;
});
} else {
setTimeout(checkVideo, 500);
}
};
checkVideo();
}

function updateProgressAndTime() {
if (videoDuration > 0) {
const progress = (currentVideoTime / videoDuration) * 100;
progressFill.style.width = progress + '%';
timeDisplay.textContent = `${formatTime(currentVideoTime)} / ${formatTime(videoDuration)}`;

const now = Date.now();
if (isPlaying && !hasUserLeft && !localUpdate && (now - lastAutoUpdate) > 5000) {
lastAutoUpdate = now;
update(watchRef, {
timestamp: Math.floor(currentVideoTime),
lastUpdate: now
});
}
}
}

function updatePlayPauseIcon() {
playPauseIcon.className = isPlaying ? 'fas fa-pause' : 'fas fa-play';
}

function getCurrentTime() {
if (isYouTube) {
return currentVideoTime;
} else {
const video = player.contentDocument?.querySelector('video');
return video ? video.currentTime : 0;
}
}

function getDuration() {
if (isYouTube) {
return videoDuration;
} else {
const video = player.contentDocument?.querySelector('video');
return video ? video.duration : 0;
}
}

function controlVideo(action, value) {
if (!playerReady || !currentLink) return;

localUpdate = true;

if (isYouTube) {
let command = '';
let args = [];
switch(action) {
case 'play':
command = 'playVideo';
break;
case 'pause':
command = 'pauseVideo';
break;
case 'seek':
command = 'seekTo';
args = [value, true];
break;
case 'forward':
command = 'seekTo';
args = [value, true];
break;
case 'backward':
command = 'seekTo';
args = [value, true];
break;
}
const message = JSON.stringify({event: 'command', func: command, args: args});
player.contentWindow.postMessage(message, '*');

if (action === 'play') isPlaying = true;
if (action === 'pause') isPlaying = false;
} else {
const video = player.contentDocument?.querySelector('video') || player;
if (video) {
switch(action) {
case 'play':
video.play().then(() => {
isPlaying = true;
updatePlayPauseIcon();
}).catch(() => {});
break;
case 'pause':
video.pause();
isPlaying = false;
updatePlayPauseIcon();
break;
case 'seek':
video.currentTime = value;
break;
case 'forward':
video.currentTime = value;
break;
case 'backward':
video.currentTime = value;
break;
}
}
}

setTimeout(() => {
localUpdate = false;
}, 200);

if (!hasUserLeft) {
if (action === 'play' || action === 'pause') {
update(watchRef, {
playing: isPlaying,
lastUpdate: Date.now()
});
} else if (action === 'seek' || action === 'forward' || action === 'backward') {
update(watchRef, {
timestamp: Math.floor(value),
lastUpdate: Date.now()
});
}
}
}

loadBtn.onclick = () => {
const link = input.value.trim();
if (!link) {
alert("Please paste a video link");
return;
}
loadVideo(link, 0);
};

input.onkeypress = e => {
if (e.key === "Enter") loadBtn.click();
};

playPauseBtn.onclick = () => {
controlVideo(isPlaying ? 'pause' : 'play');
};

prevBtn.onclick = () => {
const currentTime = getCurrentTime();
const newTime = Math.max(0, currentTime - 10);
controlVideo('backward', newTime);
};

nextBtn.onclick = () => {
const currentTime = getCurrentTime();
const duration = getDuration();
const newTime = Math.min(duration, currentTime + 10);
controlVideo('forward', newTime);
};

progressBar.onclick = (e) => {
if (!playerReady || !currentLink) return;

const rect = progressBar.getBoundingClientRect();
const percent = Math.max(0, Math.min(1, (e.clientX - rect.left) / rect.width));

if (videoDuration > 0) {
const seekTime = videoDuration * percent;
controlVideo('seek', seekTime);
}
};

document.addEventListener('visibilitychange', () => {
if (document.hidden) {
hasUserLeft = true;
isBackgroundPaused = true;
} else {
hasUserLeft = false;
setTimeout(() => {
isBackgroundPaused = false;
if (playerReady && currentLink) {
const stateRef = ref(db, "watch");
onValue(stateRef, (snap) => {
const data = snap.val();
if (data && data.timestamp !== undefined) {
const currentTime = getCurrentTime();
const timeDiff = Math.abs(currentTime - data.timestamp);
if (timeDiff > 1.5) {
controlVideo('seek', data.timestamp);
}
}
}, { once: true });
}
}, 1000);
}
});

onValue(watchRef, (snap) => {
const data = snap.val();
if (!data || hasUserLeft || isBackgroundPaused) return;

if (data.link && data.link !== currentLink) {
input.value = data.link;
loadVideo(data.link, data.timestamp || 0);
return;
}

if (!playerReady || !currentLink) return;

let effectiveTime = data.timestamp || 0;
if (data.lastUpdate && data.timestamp !== undefined && data.playing) {
const timeDiff = Math.floor((Date.now() - data.lastUpdate) / 1000);
effectiveTime = data.timestamp + timeDiff;
if (videoDuration > 0 && effectiveTime > videoDuration) {
effectiveTime = videoDuration;
}
}

if (!localUpdate) {
const currentTime = getCurrentTime();
if (Math.abs(currentTime - effectiveTime) > 1.5) {
controlVideo('seek', effectiveTime);
}

if (data.playing !== undefined && data.playing !== isPlaying) {
controlVideo(data.playing ? 'play' : 'pause');
}
}
});

async function sendChat() {
const text = chatInput.value.trim();
if (!text) return;
await push(chatRef, { text: text });
chatInput.value = "";
}

sendBtn.onclick = sendChat;
chatInput.onkeypress = e => {
if (e.key === "Enter") sendChat();
};

onValue(chatRef, (snap) => {
chatBox.innerHTML = "";
const data = snap.val();
if (!data) return;
Object.values(data).reverse().slice(0, 50).reverse().forEach(msg => {
const div = document.createElement("div");
div.className = "msg-text";
div.textContent = msg.text;
chatBox.appendChild(div);
});
chatBox.scrollTop = chatBox.scrollHeight;
});

onValue(ref(db, "watch"), (snap) => {
const data = snap.val();
if (data && data.link && firstLoad) {
firstLoad = false;
input.value = data.link;
loadVideo(data.link, data.timestamp || 0);
if (data.playing === false) {
setTimeout(() => controlVideo('pause'), 2000);
}
}
}, { once: true });

</script>
