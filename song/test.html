<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>YouTube Music Audio Player</title>
  <style>
    body { font-family:sans-serif; background:#111; color:#eee; margin:0; padding:20px; }
    h1 { margin-bottom:20px; }
    .search { margin-bottom:20px; }
    input { padding:8px; border-radius:4px; border:none; width:200px; }
    button { padding:8px 12px; border:none; border-radius:4px; margin-left:6px; cursor:pointer; background:#0af; color:#000; font-weight:bold; }
    audio { width:100%; max-width:640px; margin-bottom:20px; }
    ul { list-style:none; padding:0; max-width:640px; }
    li { margin:8px 0; padding:8px; background:#222; border-radius:6px; cursor:pointer; }
    li:hover { background:#333; }
    .title { font-weight:bold; }
    .artist { font-size:0.9em; color:#bbb; }
  </style>
</head>
<body>
  <h1>YouTube Music Audio Player</h1>

  <div class="search">
    <input id="query" placeholder="Search songs..." />
    <button id="searchBtn">Search</button>
  </div>

  <audio id="player" controls></audio>

  <ul id="playlist"></ul>

  <script>
    const BACKEND_URL = 'https://ytmusic-app-n55k.onrender.com'; // Replace with your Render URL
    const player = document.getElementById('player');
    const playlist = document.getElementById('playlist');
    const searchBtn = document.getElementById('searchBtn');
    const queryInput = document.getElementById('query');

    function search(query) {
      playlist.innerHTML = "<li>Loading...</li>";
      fetch(`${BACKEND_URL}/search?q=${encodeURIComponent(query)}`)
        .then(res => res.json())
        .then(tracks => {
          playlist.innerHTML = "";
          if (!tracks.length) {
            playlist.innerHTML = "<li>No results found</li>";
            return;
          }
          tracks.forEach(track => {
            const li = document.createElement('li');
            li.innerHTML = `<div class="title">${track.title}</div><div class="artist">${track.artist}</div>`;
            li.addEventListener('click', () => {
              // Use full backend URL with audioUrl
              player.src = `${BACKEND_URL}${track.audioUrl}`;
              player.load();
              player.play().catch(err => console.log("Play blocked:", err));
            });
            playlist.appendChild(li);
          });
        })
        .catch(err => {
          console.error(err);
          playlist.innerHTML = "<li>Error fetching results</li>";
        });
    }

    searchBtn.addEventListener('click', () => {
      const q = queryInput.value.trim();
      if (q) search(q);
    });

    queryInput.addEventListener('keypress', e => {
      if (e.key === 'Enter') searchBtn.click();
    });

    // Default search
    search('pardeshiya');
  </script>
</body>
</html>
