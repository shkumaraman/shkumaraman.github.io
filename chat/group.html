<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>TalkRush - Free Public Group Chat with Strangers</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Join TalkRush Public Group Chat – Instantly connect with strangers in fun, fast, and anonymous group chats. No sign-up required! Share images, GIFs, and make new friends online.">
  <meta name="keywords" content="TalkRush, public group chat, anonymous chat, chat with strangers, meet new people, free online chat, image and GIF sharing, Omegle alternative, Chatroulette Alternative, Emerald Chat Alternative, fun group chat, instant messaging, no signup chat">
  <link rel="icon" type="image/png" href="logo.png">
  <meta name="author" content="Aman Kumar">
  <meta property="og:image" content="https://shkumaraman.github.io/chat/logo.png">
  <meta property="og:title" content="TalkRush - Free Public Group Chat with Strangers">
  <meta property="og:description" content="Join TalkRush Public Group Chat – Instantly connect with strangers in fun, fast, and anonymous group chats. No sign-up required! Share images, GIFs, and make new friends online.">
  <meta property="og:type" content="website">  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css">
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7059052735946479" crossorigin="anonymous"></script>
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-746R2BN26S"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-746R2BN26S');
</script>  
  <style>
  :root {
    /* Dark Theme Colors */
    --dark-bg: #121212;
    --dark-header-bg: #181818;
    --dark-header-border: #2a2a2a;
    --dark-chat-bg: #1e1e1e;
    --dark-msg-bg: #2b2b2b;
    --dark-msg-me: #007bff;
    --dark-text: #fff;
    --dark-timestamp: #aaa;
    --dark-input-bg: #333;
    --dark-input-focus: #444;
    --dark-icon-color: #ccc;
    --dark-icon-hover: #fff;
    --dark-icon-hover-bg: rgba(255,255,255,0.1);
    --dark-system-msg: #aaa;
    --dark-scroll-track: #1e1e1e;
    --dark-scroll-thumb: #444;
    --dark-scroll-hover: #555;
    --dark-gif-modal: #2a2a2a;
    --dark-gif-search: #333;

    /* Light Theme Colors */
    --light-bg: #f5f5f5;
    --light-header-bg: #ffffff;
    --light-header-border: #e0e0e0;
    --light-chat-bg: #f9f9f9;
    --light-msg-bg: #e9e9e9;
    --light-msg-me: #007bff;
    --light-text: #333;
    --light-timestamp: #666;
    --light-input-bg: #e0e0e0;
    --light-input-focus: #d0d0d0;
    --light-icon-color: #666;
    --light-icon-hover: #333;
    --light-icon-hover-bg: rgba(0,0,0,0.05);
    --light-system-msg: #777;
    --light-scroll-track: #f9f9f9;
    --light-scroll-thumb: #ccc;
    --light-scroll-hover: #aaa;
    --light-gif-modal: #f0f0f0;
    --light-gif-search: #e0e0e0;

    /* Common Colors */
    --share-btn: #25D366;
    --share-btn-hover: #128C7E;
    --keyword-bubble: #f1f1f1;
    --keyword-border: #ccc;
  }

  * {
    box-sizing: border-box;
  }

  html, body {
    overflow-x: hidden;
  }
    
  body {
    margin: 0;
    padding: 0;
    font-family: 'Segoe UI', sans-serif;
    background: var(--dark-bg);
    color: var(--dark-text);
    display: flex;
    flex-direction: column;
    height: 100vh;
    transition: background 0.3s, color 0.3s;
  }

  body.light-mode {
    background: var(--light-bg);
    color: var(--light-text);
  }

  .app-header {
    position: sticky;
    top: 0;
    width: 100%;
    height: 60px;
    background: var(--dark-header-bg);
    padding: 8px 15px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 15px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.4);
    border-bottom: 1px solid var(--dark-header-border);
    z-index: 10000;
  }

  .light-mode .app-header {
    background: var(--light-header-bg);
    border-bottom: 1px solid var(--light-header-border);
  }

  .header-left {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .header-right {
    display: flex;
    align-items: center;
    gap: 10px;
  }
    
  .logo {
    height: 40px;
    width: 40px;
    border-radius: 10px;
  }

  .app-title {
    font-size: 1.5em;
    color: var(--dark-text);
    margin: 0;
  }

  .light-mode .app-title {
    color: var(--light-text);
  }

  .theme-toggle {
    background: none;
    border: none;
    color: var(--dark-icon-color);
    font-size: 1.1em;
    cursor: pointer;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: all 0.3s;
  }

  .theme-toggle:hover {
    background: var(--dark-icon-hover-bg);
  }

  .light-mode .theme-toggle {
    color: var(--light-icon-color);
  }

  .light-mode .theme-toggle:hover {
    background: var(--light-icon-hover-bg);
  }

  .share-btn {
    background: var(--share-btn);
    border: none;
    color: white;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 0.9em;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 5px;
    transition: background 0.3s;
  }

  .share-btn:hover {
    background: var(--share-btn-hover);
  }

  .share-btn i {
    font-size: 1.1em;
  }

  .share-text {
    display: inline;
  }

  .chat-container {
    display: flex;
    flex-direction: column;
    position: relative;
  }
    
  #chatLog {
    padding: 12px;
    overflow-y: auto;
    background: var(--dark-chat-bg);
    display: flex;
    flex-direction: column;
    height: calc(100vh - 175px);
  }

  .light-mode #chatLog {
    background: var(--light-chat-bg);
  }

  .msg {
    margin: 5px 0;
    padding: 5px 8px;
    background: var(--dark-msg-bg);
    border-radius: 15px;
    max-width: 80%;
    word-wrap: break-word;
    box-shadow: 0 1px 2px rgba(0,0,0,0.1);
  }

  .light-mode .msg {
    background: var(--light-msg-bg);
    color: var(--light-text);
  }

  .me { 
    align-self: flex-end; 
    background: var(--dark-msg-me);
    border-bottom-right-radius: 5px;
    color: white;
  }

  .light-mode .me {
    background: var(--light-msg-me);
    color: var(--light-text);
  }
    
  .stranger { 
    align-self: flex-start;
    border-bottom-left-radius: 5px;
  }

  .timestamp {
    font-size: 0.7em;
    color: var(--dark-timestamp);
    margin-top: 2px;
    text-align: right;
  }

  .light-mode .timestamp {
    color: var(--light-timestamp);
  }

  .chat-controls {
    position: fixed;
    bottom: 0;
    display: flex;
    align-items: center;
    padding: 5px;
    background: var(--dark-header-bg);
    width: 100%;
    z-index: 1000;
    gap: 8px;
  }

  .light-mode .chat-controls {
    background: var(--light-header-bg);
  }

  .input-area {
    flex: 1;
    position: relative;
  }

  #msgInput {
    width: 100%;
    padding: 12px 80px 12px 15px;
    border-radius: 25px;
    border: none;
    background: var(--dark-input-bg);
    color: var(--dark-text);
    font-size: 1em;
    outline: none;
  }

  #msgInput:focus {
    background: var(--dark-input-focus);
  }

  .light-mode #msgInput {
    background: var(--light-input-bg);
    color: var(--light-text);
  }

  .light-mode #msgInput:focus {
    background: var(--light-input-focus);
  }

  .input-icons {
    position: absolute;
    right: 8px;
    top: 50%;
    transform: translateY(-50%);
    display: flex;
  }

  .icon-btn {
    background: none;
    border: none;
    color: var(--dark-icon-color);
    font-size: 1.1em;
    cursor: pointer;
    transition: color 0.2s;
    width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
  }

  .icon-btn:hover { 
    color: var(--dark-icon-hover);
    background: var(--dark-icon-hover-bg);
  }

  .light-mode .icon-btn {
    color: var(--light-icon-color);
  }

  .light-mode .icon-btn:hover { 
    color: var(--light-icon-hover);
    background: var(--light-icon-hover-bg);
  }

  /* Message images */
  .msg img {
    max-width: 100%;
    max-height: 300px;
    border-radius: 8px;
    margin-bottom: 5px;
  }

  /* System messages */
  .system-msg {
    align-self: center;
    background: transparent;
    color: var(--dark-system-msg);
    text-align: center;
    padding: 5px 0;
  }

  .light-mode .system-msg {
    color: var(--light-system-msg);
  }

  /* Scrollbar styling */
  #chatLog::-webkit-scrollbar {
    width: 8px;
  }

  #chatLog::-webkit-scrollbar-track {
    background: var(--dark-scroll-track);
  }

  #chatLog::-webkit-scrollbar-thumb {
    background: var(--dark-scroll-thumb);
    border-radius: 4px;
  }

  #chatLog::-webkit-scrollbar-thumb:hover {
    background: var(--dark-scroll-hover);
  }

  .light-mode #chatLog::-webkit-scrollbar-track {
    background: var(--light-scroll-track);
  }

  .light-mode #chatLog::-webkit-scrollbar-thumb {
    background: var(--light-scroll-thumb);
  }

  .light-mode #chatLog::-webkit-scrollbar-thumb:hover {
    background: var(--light-scroll-hover);
  }

  /* GIF search modal */
  .gif-modal {
    display: none;
    position: fixed;
    bottom: 80px;
    right: 20px;
    width: 300px;
    max-height: 400px;
    background: var(--dark-gif-modal);
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    z-index: 1001;
    padding: 15px;
    overflow: hidden;
  }

  .light-mode .gif-modal {
    background: var(--light-gif-modal);
  }

  .gif-search {
    width: 100%;
    padding: 8px 12px;
    border-radius: 20px;
    border: none;
    background: var(--dark-gif-search);
    color: white;
    margin-bottom: 10px;
  }

  .light-mode .gif-search {
    background: var(--light-gif-search);
    color: var(--light-text);
  }

  .gif-results {
    height: 300px;
    overflow-y: auto;
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 8px;
  }

  .gif-item {
    width: 100%;
    height: 100px;
    object-fit: cover;
    border-radius: 5px;
    cursor: pointer;
    transition: transform 0.2s;
  }

  .gif-item:hover {
    transform: scale(1.05);
  }
 
 .keyword-bubble {
  background-color: var(--keyword-bubble);
  border-radius: 20px;
  padding: 8px 16px;
  font-size: 14px;
  color: var(--light-text);
  border: 1px solid var(--keyword-border);
  transition: background 0.3s;
}
    
 .footer {
    text-align: center;
    padding: 15px;
    color: #777;
    font-size: 0.9em;
    margin-bottom: 75px;
  }

  /* Modal Styles */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.4);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 10000;
  padding: 20px;
  box-sizing: border-box;
}

.modal-content {
  background: white;
  color: #333;
  padding: 20px;
  border-radius: 8px;
  text-align: center;
  max-width: 400px;
  width: 100%;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: 0 5px 15px rgba(0,0,0,0.3);
}

.modal-buttons {
  display: flex;
  flex-direction: column;
  gap: 10px;
  margin: 20px 0;
}

.modal-btn {
  border: none;
  padding: 12px 15px;
  cursor: pointer;
  border-radius: 5px;
  font-size: 16px;
  font-weight: bold;
  width: 100%;
  transition: all 0.3s ease;
}

.modal-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}

.orange-btn {
  background: #FFA500;
  color: #333;
}

.red-btn {
  background: #FF0000;
  color: white;
}

.green-btn {
  background: #00C853;
  color: white;
}

.modal-ad {
  margin-top: 20px;
}
    
  /* Responsive adjustments */
  @media (max-width: 600px) {
    .msg {
      max-width: 85%;
    }
    .share-text {
      display: none;
    }
    .share-btn {
      padding: 6px;
    }
    .gif-modal {
      width: 90%;
      left: 5%;
      right: 5%;
    }
  }
  
  /* Hide file inputs */
  #imgInput, #gifInput {
    display: none;
  }
  </style>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {
      "@type": "Question",
      "name": "Is TalkRush Group Chat completely free?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Yes, TalkRush Group Chat is 100% free to use with no registration or hidden costs."
      }
    },
    {
      "@type": "Question",
      "name": "Can I share images and GIFs in group chat?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Yes, you can share both images and GIFs in the group chat with all participants."
      }
    },
    {
      "@type": "Question",
      "name": "How many people can join a group chat?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Our group chats support multiple participants, with proper peer-to-peer connections for media sharing."
      }
    }
  ]
}
</script>
</head>
<body>
<div class="chat-container">
<header class="app-header">
  <div class="header-left">
    <img src="logo.png" alt="TalkRush Logo" class="logo">
    <h1 class="app-title">TalkRush Group</h1>
  </div>
  <div class="header-right">
    <button class="theme-toggle" id="themeToggle" title="Toggle Dark/Light Mode">
      <i class="fas fa-moon"></i>
    </button>
    <button class="share-btn" onclick="window.open('https://wa.me/?text=Try%20this%20free%20group%20chat:%20https://shkumaraman.github.io/chat/group.html', '_blank')">
      <i class="fab fa-whatsapp"></i>
      <span class="share-text">Share</span>
    </button>
  </div>
</header>

  <div id="chatLog"></div>

  <div class="chat-controls">
    <div class="input-area">
      <input type="text" id="msgInput" placeholder="Type your message..." />
      <div class="input-icons">
        <button id="imgBtn" class="icon-btn" title="Send Image"><i class="fas fa-image"></i></button>
        <button id="gifBtn" class="icon-btn" title="Send GIF"><i class="fas fa-film"></i></button>
        <button id="sendBtn" class="icon-btn" title="Send"><i class="fas fa-paper-plane"></i></button>
      </div>
    </div>
  </div>
  
  <input type="file" id="imgInput" accept="image/*" />
  <input type="file" id="gifInput" accept="image/gif" />
  
  <!-- GIF Search Modal -->
  <div class="gif-modal" id="gifModal">
    <input type="text" class="gif-search" id="gifSearch" placeholder="Search GIFs..." />
    <div class="gif-results" id="gifResults"></div>
  </div>
</div>
  
<div style="width:95%; max-width:700px; margin:20px auto; text-align:center;">
  <h3 style="font-size:22px; margin-bottom:20px;">Start Chat With</h3>

  <div style="display:flex; justify-content:space-between; gap:20px; flex-wrap:wrap;">
    <a href="index.html" style="flex:1; min-width:130px; padding:12px 0; background-color:#FFA500; color:#333; border:none; border-radius:25px; font-size:16px; font-weight:bold; text-decoration:none; text-align:center;">
      Stranger Chat
    </a>

    <a href="video.html" style="flex:1; min-width:130px; padding:12px 0; background-color:#00C853; color:#fff; border:none; border-radius:25px; font-size:16px; font-weight:bold; text-decoration:none; text-align:center;">
      Video Call
    </a>
  </div>
</div>

    <!-- Display Ads -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-7059052735946479"
       data-ad-slot="8592327962"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
  
<main class="info-section" style="padding: 20px; max-width: 800px; margin: 0 auto;">
  <h2>TalkRush Anonymous Group Chat – A Safe Chat Room to Talk to Strangers</h2>
  <p><strong>TalkRush Stranger Group Chat</strong> is a <strong>free online group chat</strong> platform where you can connect with people instantly — no login, no signup, no hassle. Dive into <strong>real-time group chat with strangers</strong> and enjoy a simple, private, and modern chat experience.</p>

  <p>Whether you're looking to <strong>talk to strangers</strong>, join a <strong>random chat room</strong>, or explore a <strong>safe Omegle alternative</strong>, TalkRush provides a secure, high-speed way to connect with others across the globe.</p>

  <p><strong>TalkRush includes built-in moderation and content filtering</strong> to help ensure a <strong>safe chat</strong> environment. We prioritize respectful, family-friendly group chats while allowing for dynamic, fun interactions.</p>

  <div class="info-section" style="padding: 20px; max-width: 800px; margin: 20px auto;">
    <p><strong>Group chat with strangers</strong> in real time — no login, no signup, no personal info required. Just jump in and start chatting.</p>
    <p><strong>Anonymous group chat</strong> on TalkRush includes features like image sharing, GIF support, and modern design. Unlike many <strong>chat rooms</strong> filled with spam, ours are lightweight, fast, and respectful.</p>

    <p>Perfect for those looking for a fun <strong>text chat</strong> or to <strong>meet new friends</strong> in a social yet anonymous space. Whether you're using a desktop or <strong>mobile chat</strong>, TalkRush gives you seamless access.</p>
  </div>

  <!-- Display Ads -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-7059052735946479"
       data-ad-slot="8592327962"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
  
  <div id="comprehensive-keywords" style="padding: 20px; max-width: 800px; margin: 20px auto 0 auto; display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;">
  <!-- Purane keywords -->
  <span class="keyword-bubble">Talk to strangers</span>
  <span class="keyword-bubble">Random chat</span>
  <span class="keyword-bubble">Group chat</span>
  <span class="keyword-bubble">Anonymous chat</span>
  <span class="keyword-bubble">Free online chat</span>
  <span class="keyword-bubble">Stranger chat</span>
  <span class="keyword-bubble">Safe chat</span>
  <span class="keyword-bubble">Text chat</span>
  <span class="keyword-bubble">Chat rooms</span>
  <span class="keyword-bubble">Mobile chats</span>
  <span class="keyword-bubble">Meet new friends</span>
  <span class="keyword-bubble">Omegle alternative</span>
  <span class="keyword-bubble">OmeTV alternative</span>
  <span class="keyword-bubble">Girls chat</span>
  <span class="keyword-bubble">Modern chat platform</span>
  <span class="keyword-bubble">Video chat with strangers</span>
  <span class="keyword-bubble">Anonymous group chat</span>
  <span class="keyword-bubble">Chat with random people</span>
  <span class="keyword-bubble">Meet strangers online</span>
  <span class="keyword-bubble">Live chat room</span>
  <span class="keyword-bubble">No login chat</span>
  <span class="keyword-bubble">Instant random chat</span>
  <span class="keyword-bubble">Free group chat</span>
  <span class="keyword-bubble">LGBTQ+ chat</span>
  <span class="keyword-bubble">Stranger video call</span>
  <span class="keyword-bubble">Mobile friendly chat</span>
  <span class="keyword-bubble">Anonymous texting app</span>
  <span class="keyword-bubble">Online chat now</span>
  <span class="keyword-bubble">Make new online friends</span>
</div>

</main>
  
<!-- Modal Overlay -->
<div id="chatModal" class="modal-overlay">
  <!-- Modal Box -->
  <div class="modal-content">
    <h3>Select Chat Type</h3>

    <!-- Chat Buttons -->
    <div class="modal-buttons">
      <button onclick="window.location.href='index.html'" class="modal-btn orange-btn">
        Private Chat
      </button>

      <button onclick="window.location.href='video.html'" class="modal-btn red-btn">
        Video Call
      </button>

      <button onclick="closeModal()" class="modal-btn green-btn">
        Group Chat
      </button>
    </div>

    <!-- AdSense Ad Below Buttons -->
    <div class="modal-ad">
      <ins class="adsbygoogle"
           style="display:block"
           data-ad-client="ca-pub-7059052735946479"
           data-ad-slot="8592327962"
           data-ad-format="auto"
           data-full-width-responsive="true"></ins>
    </div>
  </div>
</div>

<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-7059052735946479"
     data-ad-slot="1798823861"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
  
<footer class="footer">
  Made with love in Bharat ♥️
</footer>
  
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap/dist/js/bootstrap.bundle.min.js"></script>  
<script>
// Firebase config
const firebaseConfig = {
  databaseURL: "https://talkrush-76259-default-rtdb.asia-southeast1.firebasedatabase.app/"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let myId;
let lastMessageTimestamp = 0;
const messageLimit = 25;
let isSendingGif = false;
let isSendingMessage = false;
let initialMessagesLoaded = false;

// Bad word filter system
let bannedWords = [];

// Load the banned words from filter.txt
async function loadBannedWords() {
  try {
    const response = await fetch('filter.txt');
    const text = await response.text();
    bannedWords = text.split('\n').map(word => word.trim().toLowerCase());
    console.log("Banned words loaded successfully");
  } catch (err) {
    console.error("Error loading banned words:", err);
  }
}

// Enhanced check for banned words with case insensitivity and word boundaries
function containsBannedWords(message) {
  const lowerMsg = message.toLowerCase();
  return bannedWords.some(word => {
    if (!word) return false;
    // Create regex pattern that matches word with any case variation
    const pattern = new RegExp(`\\b${word}\\b`, 'i');
    return pattern.test(message);
  });
}

// Initialize chat when page loads
function initializeChat() {
  myId = 'user_' + Math.random().toString(36).substr(2, 9);
  loadBannedWords();
  logSystem("Welcome to TalkRush Group Chat!");
  joinGroupChat();
}

function joinGroupChat() {
  const messagesRef = db.ref("group/messages").limitToLast(messageLimit);
  
  if (!initialMessagesLoaded) {
    messagesRef.once('value', (snapshot) => {
      const messages = snapshot.val();
      if (messages) {
        Object.values(messages).forEach(msg => {
          if (msg.timestamp > lastMessageTimestamp) {
            displayMessage(msg);
            lastMessageTimestamp = msg.timestamp;
          }
        });
      }
      scrollToBottom();
      initialMessagesLoaded = true;
    });
  }
  
  messagesRef.on('child_added', (snapshot) => {
    const msg = snapshot.val();
    if (msg.timestamp > lastMessageTimestamp && msg.sender !== myId) {
      displayMessage(msg);
      lastMessageTimestamp = msg.timestamp;
      scrollToBottom();
    }
  });
}

function sendMessageToGroup(text) {
  if (!text.trim() || isSendingMessage) return;
  isSendingMessage = true;
  
  const timestamp = Date.now();
  const message = {
    text: text,
    sender: myId,
    timestamp: timestamp
  };
  
  appendMessage("me", text, timestamp);
  
  const newMsgRef = db.ref("group/messages").push();
  newMsgRef.set(message)
    .then(() => {
      isSendingMessage = false;
    })
    .catch(err => {
      console.error("Error sending message:", err);
      isSendingMessage = false;
    });
}

function compressImage(file, callback) {
  const reader = new FileReader();
  reader.onload = function(event) {
    const img = new Image();
    img.onload = function() {
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');
      
      let width = img.width;
      let height = img.height;
      const maxDimension = 1024;
      const quality = 0.7;
      
      if (width > height) {
        if (width > maxDimension) {
          height *= maxDimension / width;
          width = maxDimension;
        }
      } else {
        if (height > maxDimension) {
          width *= maxDimension / height;
          height = maxDimension;
        }
      }
      
      canvas.width = width;
      canvas.height = height;
      ctx.drawImage(img, 0, 0, width, height);
      
      let qualityAdjusted = quality;
      let result;
      
      do {
        result = canvas.toDataURL('image/jpeg', qualityAdjusted);
        qualityAdjusted -= 0.05;
        if (qualityAdjusted <= 0.1) break;
      } while (result.length > 100 * 1024);
      
      if (result.length > 100 * 1024) {
        width *= 0.9;
        height *= 0.9;
        canvas.width = width;
        canvas.height = height;
        ctx.drawImage(img, 0, 0, width, height);
        result = canvas.toDataURL('image/jpeg', 0.7);
      }
      
      callback(result);
    };
    img.src = event.target.result;
  };
  reader.readAsDataURL(file);
}

function sendImageToGroup(blob) {
  if (isSendingMessage) return;
  isSendingMessage = true;
  
  const timestamp = Date.now();
  const message = {
    type: "image",
    sender: myId,
    timestamp: timestamp,
    blob: blob
  };
  
  appendImage("me", blob, timestamp);
  
  const newMsgRef = db.ref("group/messages").push();
  newMsgRef.set(message)
    .then(() => {
      isSendingMessage = false;
    })
    .catch(err => {
      console.error("Error sending image:", err);
      isSendingMessage = false;
    });
}

function sendGifToGroup(url) {
  if (isSendingGif || isSendingMessage) return;
  isSendingGif = true;
  isSendingMessage = true;
  
  const timestamp = Date.now();
  const message = {
    type: "gif",
    sender: myId,
    timestamp: timestamp,
    url: url
  };
  
  appendGif("me", url, timestamp);
  
  const newMsgRef = db.ref("group/messages").push();
  newMsgRef.set(message)
    .then(() => {
      isSendingGif = false;
      isSendingMessage = false;
    })
    .catch(err => {
      console.error("Error sending GIF:", err);
      isSendingGif = false;
      isSendingMessage = false;
    });
}

// UI Functions
function displayMessage(msg) {
  if (document.querySelector(`[data-id="${msg.timestamp}"]`)) return;
  
  const div = document.createElement("div");
  div.className = "msg " + (msg.sender === myId ? "me" : "stranger");
  div.setAttribute('data-id', msg.timestamp);
  
  if (msg.type === "image") {
    const img = document.createElement("img");
    img.src = msg.blob;
    div.appendChild(img);
  } else if (msg.type === "gif") {
    const img = document.createElement("img");
    img.src = msg.url;
    div.appendChild(img);
  } else {
    div.textContent = msg.text;
  }
  
  const time = document.createElement("div");
  time.className = "timestamp";
  time.textContent = formatTimestamp(msg.timestamp);
  div.appendChild(time);
  document.getElementById("chatLog").appendChild(div);
}

function appendMessage(sender, msg, timestamp = Date.now()) {
  if (document.querySelector(`[data-id="${timestamp}"]`)) return;
  
  const div = document.createElement("div");
  div.className = "msg " + sender;
  div.setAttribute('data-id', timestamp);
  div.textContent = msg;
  const time = document.createElement("div");
  time.className = "timestamp";
  time.textContent = formatTimestamp(timestamp);
  div.appendChild(time);
  document.getElementById("chatLog").appendChild(div);
  scrollToBottom();
}

function appendImage(sender, blob, timestamp = Date.now()) {
  if (document.querySelector(`[data-id="${timestamp}"]`)) return;
  
  const div = document.createElement("div");
  div.className = "msg " + sender;
  div.setAttribute('data-id', timestamp);
  const img = document.createElement("img");
  img.src = blob;
  div.appendChild(img);
  const time = document.createElement("div");
  time.className = "timestamp";
  time.textContent = formatTimestamp(timestamp);
  div.appendChild(time);
  document.getElementById("chatLog").appendChild(div);
  scrollToBottom();
}

function appendGif(sender, url, timestamp = Date.now()) {
  if (document.querySelector(`[data-id="${timestamp}"]`)) return;
  
  const div = document.createElement("div");
  div.className = "msg " + sender;
  div.setAttribute('data-id', timestamp);
  const img = document.createElement("img");
  img.src = url;
  div.appendChild(img);
  const time = document.createElement("div");
  time.className = "timestamp";
  time.textContent = formatTimestamp(timestamp);
  div.appendChild(time);
  document.getElementById("chatLog").appendChild(div);
  scrollToBottom();
}

function formatTimestamp(timestamp) {
  if (!timestamp) return "";
  const date = new Date(timestamp);
  return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
}

function scrollToBottom() {
  const log = document.getElementById("chatLog");
  log.scrollTop = log.scrollHeight;
}

function logSystem(msg) {
  const div = document.createElement("div");
  div.className = "msg system-msg";
  div.textContent = msg;
  document.getElementById("chatLog").appendChild(div);
  scrollToBottom();
}

// Event Listeners
document.getElementById("msgInput").addEventListener("keypress", (e) => {
  if (e.key === "Enter") {
    sendMessage();
  }
});

document.getElementById("sendBtn").onclick = sendMessage;

function sendMessage() {
  const input = document.getElementById("msgInput");
  const msg = input.value.trim();
  
  if (msg) {
    if (containsBannedWords(msg)) {
      logSystem("Your message contains inappropriate content and cannot be sent.");
      input.value = "";
      return;
    }
    
    sendMessageToGroup(msg);
    input.value = "";
  }
}

// Image button click handler
document.getElementById("imgBtn").addEventListener("click", () => {
  document.getElementById("imgInput").click();
});

document.getElementById("imgInput").addEventListener("change", (e) => {
  const file = e.target.files[0];
  if (!file) return;

  if (file.size > 5 * 1024 * 1024) {
    logSystem("Image too large! Please select an image smaller than 5MB.");
    e.target.value = "";
    return;
  }

  compressImage(file, (compressedImage) => {
    sendImageToGroup(compressedImage);
  });
  
  e.target.value = "";
});

// GIF button click handler
document.getElementById("gifBtn").addEventListener("click", (e) => {
  e.preventDefault();
  gifModal.style.display = gifModal.style.display === "block" ? "none" : "block";
  if (gifModal.style.display === "block") {
    fetchTrendingGifs();
  }
});

// GIF Search functionality
const gifModal = document.getElementById("gifModal");
const gifSearch = document.getElementById("gifSearch");
const gifResults = document.getElementById("gifResults");

gifSearch.addEventListener("keypress", (e) => {
  if (e.key === "Enter") {
    searchGifs(gifSearch.value);
  }
});

async function fetchTrendingGifs() {
  try {
    const response = await fetch(`https://g.tenor.com/v1/trending?key=LIVDSRZULELA&limit=20`);
    const data = await response.json();
    displayGifs(data.results);
  } catch (error) {
    console.error("Error fetching GIFs:", error);
  }
}

async function searchGifs(query) {
  try {
    const response = await fetch(`https://g.tenor.com/v1/search?q=${encodeURIComponent(query)}&key=LIVDSRZULELA&limit=20`);
    const data = await response.json();
    displayGifs(data.results);
  } catch (error) {
    console.error("Error searching GIFs:", error);
  }
}

function displayGifs(gifs) {
  gifResults.innerHTML = "";
  gifs.forEach(gif => {
    const gifUrl = gif.media[0].gif.url;
    const img = document.createElement("img");
    img.src = gifUrl;
    img.className = "gif-item";
    img.onclick = () => {
      sendGifToGroup(gifUrl);
      gifModal.style.display = "none";
    };
    gifResults.appendChild(img);
  });
}

window.addEventListener("click", (e) => {
  if (e.target === gifModal) {
    gifModal.style.display = "none";
  }
});

// Theme toggle functionality
const themeToggle = document.getElementById('themeToggle');
const body = document.body;

const savedTheme = localStorage.getItem('theme') || 
                   (window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark');

if (savedTheme === 'light') {
  body.classList.add('light-mode');
  themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
} else {
  themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
}

themeToggle.addEventListener('click', () => {
  body.classList.toggle('light-mode');
  
  if (body.classList.contains('light-mode')) {
    localStorage.setItem('theme', 'light');
    themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
  } else {
    localStorage.setItem('theme', 'dark');
    themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
  }
});

function closeModal() {
  document.getElementById('chatModal').style.display = 'none';
}

window.addEventListener('load', initializeChat);
</script>
</body>
</html>
