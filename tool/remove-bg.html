<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Size Reducer</title>
    <script src="https://rawgit.com/eKoopmans/html2pdf/master/dist/html2pdf.bundle.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.js"></script>
</head>
<body>

<div>
    <input type="file" id="pdfInput" accept=".pdf">
</div>

<div id="pdfContainer">
    <!-- Your PDF content will be displayed here -->
</div>

<div>
    <input type="range" id="qualitySlider" min="0" max="100" value="100">
</div>

<button onclick="reducePdf()">Reduce PDF Size</button>

<script>
    function handleFile() {
        const fileInput = document.getElementById('pdfInput');
        const pdfContainer = document.getElementById('pdfContainer');
        const qualitySlider = document.getElementById('qualitySlider');

        const file = fileInput.files[0];
        const reader = new FileReader();

        reader.onload = function (e) {
            const content = e.target.result;
            renderPdf(content, pdfContainer, qualitySlider.value / 100);
        };

        reader.readAsDataURL(file);
    }

    async function renderPdf(data, container, quality) {
        const pdfContainer = container;
        const qualityValue = quality;

        const pdfDoc = new jsPDF();
        const pdfWidth = pdfDoc.internal.pageSize.getWidth();
        const pdfHeight = pdfDoc.internal.pageSize.getHeight();

        const img = new Image();
        img.src = data;

        img.onload = function () {
            const canvas = document.createElement('canvas');
            canvas.width = pdfWidth;
            canvas.height = pdfHeight;

            const context = canvas.getContext('2d');
            context.drawImage(img, 0, 0, pdfWidth, pdfHeight);

            const imageData = canvas.toDataURL('image/jpeg', qualityValue);
            pdfContainer.innerHTML = `<img src="${imageData}" alt="PDF Preview" width="100%" height="auto"/>`;
        };
    }

    function reducePdf() {
        const pdfContainer = document.getElementById("pdfContainer");

        html2pdf(pdfContainer, {
            margin: 10,
            filename: 'reduced_pdf',
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { scale: 2 },
            jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
        }).then(function (pdf) {
            pdf.save();
        });
    }

    document.getElementById('pdfInput').addEventListener('change', handleFile);
</script>

</body>
</html>
