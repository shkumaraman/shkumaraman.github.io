<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User-Generated Q&A</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        body {
            font-family: 'Helvetica Neue', sans-serif;
            background-color: #f5f8fa;
            margin: 10px;
        }

        .search-bar,
        .ask-question {
            display: flex;
            justify-content: space-between;
            background-color: #ffffff;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #e1e8ed;
            margin-bottom: 10px;
        }

        .question,
        .answer {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
            background-color: #ffffff;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #e1e8ed;
            color: #14171a;
            position: relative;
        }

        .comment {
            margin-left: 20px;
            padding: 5px;
            background-color: #f5f5f5;
            border-radius: 4px;
            border: 1px solid #ccc;
        }

        .input-container {
            display: flex;
            align-items: flex-end;
            margin-top: 10px;
        }

        textarea {
            width: 70%;
            padding: 8px;
            margin-right: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }

        button {
            background-color: #1da1f2;
            color: #ffffff;
            border: none;
            height: 50px;
            width: 100px;
            border-radius: 4px;
            cursor: pointer;
        }

        .edit-options {
            position: absolute;
            top: 5px;
            right: 5px;
            display: flex;
            align-items: center;
        }

        .edit-options button {
            margin-left: 5px;
            height: 30px;
            width: 30px;
        }

        .user-identifier {
            position: absolute;
            bottom: 5px;
            left: 5px;
            font-size: 12px;
            color: #657786;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="search-bar">
            <textarea id="searchQuery" placeholder="Search Questions..." class="search-textarea"></textarea>
            <button onclick="searchQuestions()">Search</button>
        </div>
        <div class="ask-question">
            <textarea id="newQuestion" placeholder="Ask a Question..."></textarea>
            <button onclick="submitQuestion()">Ask</button>
        </div>
        <div id="questionsAndAnswers"></div>
    </div>

    <script>
        const questionsAndAnswers = [];

        function submitAnswer(qIndex) {
            const answer = document.getElementById('newAnswer' + qIndex).value;
            if (answer && answer.trim() !== '') {
                const userIdentifier = getUserIdentifier();
                questionsAndAnswers[qIndex].answers.push({
                    content: answer,
                    type: 'answer',
                    userIdentifier: userIdentifier,
                    comments: [],
                });
                displayQuestionsAndAnswers();
            }
        }

        function submitComment(qIndex, aIndex) {
            const comment = prompt('Type your comment:');
            if (comment && comment.trim() !== '') {
                const userIdentifier = getUserIdentifier();
                questionsAndAnswers[qIndex].answers[aIndex].comments.push({
                    content: comment,
                    userIdentifier: userIdentifier,
                });
                displayQuestionsAndAnswers();
            }
        }

        function submitQuestion() {
            const question = document.getElementById('newQuestion').value;
            if (question && question.trim() !== '') {
                questionsAndAnswers.push({ content: question, answers: [], type: 'question' });
                document.getElementById('newQuestion').value = '';
                displayQuestionsAndAnswers();
            }
        }

        function editQuestion(qIndex) {
            const newContent = prompt('Edit your question:', questionsAndAnswers[qIndex].content);
            if (newContent !== null) {
                questionsAndAnswers[qIndex].content = newContent;
                displayQuestionsAndAnswers();
            }
        }

        function saveEdit(qIndex) {
            displayQuestionsAndAnswers();
        }

        function deleteQuestion(qIndex) {
            if (confirm('Are you sure you want to delete this question?')) {
                questionsAndAnswers.splice(qIndex, 1);
                displayQuestionsAndAnswers();
            }
        }

        function editAnswer(qIndex, aIndex) {
            const newContent = prompt('Edit your answer:', questionsAndAnswers[qIndex].answers[aIndex].content);
            if (newContent !== null) {
                questionsAndAnswers[qIndex].answers[aIndex].content = newContent;
                displayQuestionsAndAnswers();
            }
        }

        function deleteAnswer(qIndex, aIndex) {
            if (confirm('Are you sure you want to delete this answer?')) {
                questionsAndAnswers[qIndex].answers.splice(aIndex, 1);
                displayQuestionsAndAnswers();
            }
        }

        function getUserIdentifier() {
            // For simplicity, generating a user identifier based on IP address
            const ip = Math.random().toString(36).substring(2, 7);
            return '#' + ip.toUpperCase();
        }

        function searchQuestions() {
            const searchQuery = document.getElementById('searchQuery').value.toLowerCase();
            const filteredQuestionsAndAnswers = questionsAndAnswers.filter(qa =>
                qa.content.toLowerCase().includes(searchQuery) ||
                qa.answers.some(answer => answer.content.toLowerCase().includes(searchQuery) ||
                    answer.comments.some(comment => comment.content.toLowerCase().includes(searchQuery))
                )
            );
            displayQuestionsAndAnswers(filteredQuestionsAndAnswers);
        }

        function displayQuestionsAndAnswers(data = questionsAndAnswers) {
            const container = document.getElementById('questionsAndAnswers');
            container.innerHTML = '';

            data.forEach((qa, qIndex) => {
                const qaElement = document.createElement('div');
                qaElement.className = qa.type;

                const editOptions = document.createElement('div');
                editOptions.className = 'edit-options';

                const editButton = document.createElement('button');
                editButton.innerHTML = '<i class="fas fa-edit"></i>';
                editButton.onclick = () => {
                    if (qa.type === 'question') {
                        editQuestion(qIndex);
                    }
                };

                const deleteButton = document.createElement('button');
                deleteButton.innerHTML = '<i class="fas fa-trash-alt"></i>';
                deleteButton.onclick = () => {
                    if (qa.type === 'question') {
                        deleteQuestion(qIndex);
                    }
                };

                editOptions.appendChild(editButton);
                editOptions.appendChild(deleteButton);

                qaElement.appendChild(editOptions);

                const contentElement = document.createElement('span');
                contentElement.innerText = qa.content;

                if (qa.type === 'answer') {
                    const userIdentifier = document.createElement('div');
                    userIdentifier.className = 'user-identifier';
                    userIdentifier.innerText = 'User: ' + qa.userIdentifier;
                    qaElement.appendChild(userIdentifier);

                    const commentsContainer = document.createElement('div');
                    commentsContainer.className = 'comments-container';

                    qa.comments.forEach((comment, cIndex) => {
                        const commentElement = document.createElement('div');
                        commentElement.className = 'comment';
                        commentElement.innerText = `${comment.userIdentifier}: ${comment.content}`;

                        const commentOptions = document.createElement('div');
                        commentOptions.className = 'edit-options';

                        const deleteCommentButton = document.createElement('button');
                        deleteCommentButton.innerHTML = '<i class="fas fa-trash-alt"></i>';
                        deleteCommentButton.onclick = () => deleteComment(qIndex, cIndex);

                        commentOptions.appendChild(deleteCommentButton);
                        commentElement.appendChild(commentOptions);
                        commentsContainer.appendChild(commentElement);
                    });

                    const commentInputContainer = document.createElement('div');
                    commentInputContainer.className = 'input-container';

                    const commentTextarea = document.createElement('textarea');
                    commentTextarea.placeholder = 'Type your comment...';

                    const commentSubmitButton = document.createElement('button');
                    commentSubmitButton.innerText = 'Comment';
                    commentSubmitButton.onclick = () => submitComment(qIndex);

                    commentInputContainer.appendChild(commentTextarea);
                    commentInputContainer.appendChild(commentSubmitButton);

                    qaElement.appendChild(commentsContainer);
                    qaElement.appendChild(commentInputContainer);
                } else {
                    const inputContainer = document.createElement('div');
                    inputContainer.className = 'input-container';

                    const textarea = document.createElement('textarea');
                    textarea.id = 'newAnswer' + qIndex;
                    textarea.placeholder = 'Type your answer...';

                    const submitButton = document.createElement('button');
                    submitButton.innerText = 'Answer';
                    submitButton.onclick = () => submitAnswer(qIndex);

                    inputContainer.appendChild(textarea);
                    inputContainer.appendChild(submitButton);

                    qaElement.appendChild(contentElement);
                    qaElement.appendChild(inputContainer);
                }

                container.appendChild(qaElement);
            });
        }

        // Initial display
        displayQuestionsAndAnswers();
    </script>
</body>
</html>
